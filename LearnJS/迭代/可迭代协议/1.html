<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JavaScript å¯è¿­ä»£å™¨åè®®å®Œæ•´ç¤ºä¾‹</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        color: #333;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        padding: 20px;
        min-height: 100vh;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: 1fr;
        gap: 30px;
      }

      @media (max-width: 900px) {
        .container {
          grid-template-columns: 1fr;
        }
      }

      .section {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
      }

      .section:hover {
        transform: translateY(-5px);
      }

      h1 {
        text-align: center;
        color: #2c3e50;
        margin-bottom: 30px;
        font-size: 2.5rem;
        grid-column: 1 / -1;
        padding: 20px;
        background: white;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      h2 {
        color: #3498db;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 3px solid #3498db;
      }

      h3 {
        color: #2c3e50;
        margin: 15px 0 10px;
      }

      .code-block {
        background: #2c3e50;
        color: #ecf0f1;
        padding: 15px;
        border-radius: 8px;
        font-family: "Courier New", monospace;
        margin: 15px 0;
        overflow-x: auto;
        font-size: 14px;
      }

      .example-box {
        border: 2px dashed #3498db;
        border-radius: 10px;
        padding: 20px;
        margin: 20px 0;
        background: #f8f9fa;
      }

      .visualization {
        background: #2c3e50;
        color: white;
        padding: 15px;
        border-radius: 10px;
        margin: 15px 0;
        min-height: 150px;
      }

      .iterator-flow {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin: 20px 0;
        padding: 10px;
        background: #ecf0f1;
        border-radius: 10px;
      }

      .flow-step {
        text-align: center;
        padding: 10px;
        flex: 1;
      }

      .flow-step .icon {
        font-size: 24px;
        margin-bottom: 5px;
        color: #3498db;
      }

      .flow-arrow {
        font-size: 24px;
        color: #3498db;
        padding: 0 10px;
      }

      button {
        background: #3498db;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin: 5px;
        transition: background 0.3s, transform 0.2s;
      }

      button:hover {
        background: #2980b9;
        transform: scale(1.05);
      }

      button:active {
        transform: scale(0.98);
      }

      .output {
        background: #ecf0f1;
        padding: 15px;
        border-radius: 8px;
        margin-top: 15px;
        min-height: 50px;
        white-space: pre-wrap;
        font-family: "Courier New", monospace;
      }

      .output-item {
        display: inline-block;
        background: #3498db;
        color: white;
        padding: 8px 12px;
        margin: 5px;
        border-radius: 5px;
        animation: fadeIn 0.5s;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .highlight {
        background: #f1c40f;
        padding: 2px 5px;
        border-radius: 3px;
        color: #2c3e50;
      }

      .explanation {
        background: #e8f4fc;
        padding: 15px;
        border-radius: 8px;
        margin: 15px 0;
        border-left: 4px solid #3498db;
      }

      .built-in-examples {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin: 20px 0;
      }

      .example-card {
        background: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 15px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s;
      }

      .example-card:hover {
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        border-color: #3498db;
      }

      .status {
        padding: 10px;
        margin: 10px 0;
        border-radius: 5px;
        text-align: center;
        font-weight: bold;
      }

      .status.done {
        background: #2ecc71;
        color: white;
      }

      .status.iterating {
        background: #f39c12;
        color: white;
      }
    </style>
  </head>
  <body>
    <script src="/run.js"></script>
    <div>
      <button onclick="window.MyUtils.onBackToParent()">è¿”å›ä¸Šä¸€çº§</button>
    </div>

    <h1>ğŸ¯ JavaScript å¯è¿­ä»£å™¨åè®®å®Œæ•´ç¤ºä¾‹</h1>

    <div class="container">
      <!-- å·¦ä¾§ï¼šç†è®ºçŸ¥è¯† -->
      <div class="section">
        <h2>ğŸ“š å¯è¿­ä»£å™¨åè®®ç†è®º</h2>

        <div class="explanation">
          <h3>ä»€ä¹ˆæ˜¯å¯è¿­ä»£å™¨åè®®ï¼Ÿ</h3>
          <p>å¯è¿­ä»£å™¨åè®®æ˜¯ <span class="highlight">ES6 å¼•å…¥çš„æ ‡å‡†åŒ–åè®®</span>ï¼Œå…è®¸ JavaScript å¯¹è±¡å®šä¹‰å®ƒä»¬çš„è¿­ä»£è¡Œä¸ºã€‚</p>
        </div>

        <div class="explanation">
          <h3>ä¸¤ä¸ªæ ¸å¿ƒéƒ¨åˆ†ï¼š</h3>
          <p><strong>1. å¯è¿­ä»£å¯¹è±¡ (Iterable)</strong>ï¼šå®ç°äº† <code class="highlight">[Symbol.iterator]()</code> æ–¹æ³•çš„å¯¹è±¡</p>
          <p><strong>2. è¿­ä»£å™¨ (Iterator)</strong>ï¼šå®ç°äº† <code class="highlight">next()</code> æ–¹æ³•çš„å¯¹è±¡</p>
        </div>

        <div class="iterator-flow">
          <div class="flow-step">
            <div class="icon">ğŸ”„</div>
            <div>å¯è¿­ä»£å¯¹è±¡</div>
            <small>æœ‰ [Symbol.iterator]()</small>
          </div>
          <div class="flow-arrow">â†’</div>
          <div class="flow-step">
            <div class="icon">ğŸ”§</div>
            <div>è°ƒç”¨æ–¹æ³•</div>
            <small>obj[Symbol.iterator]()</small>
          </div>
          <div class="flow-arrow">â†’</div>
          <div class="flow-step">
            <div class="icon">âš™ï¸</div>
            <div>è¿”å›è¿­ä»£å™¨</div>
            <small>æœ‰ next() æ–¹æ³•</small>
          </div>
          <div class="flow-arrow">â†’</div>
          <div class="flow-step">
            <div class="icon">ğŸ“¤</div>
            <div>è°ƒç”¨ next()</div>
            <small>{value, done}</small>
          </div>
        </div>

        <h3>åŸºç¡€ä»£ç ç¤ºä¾‹ï¼š</h3>
        <div class="code-block" style="white-space: pre;">
// 1. åˆ›å»ºè‡ªå®šä¹‰å¯è¿­ä»£å¯¹è±¡
const myIterable = {
    data: ['è‹¹æœ', 'é¦™è•‰', 'æ©™å­'],
    [Symbol.iterator]() {
        let index = 0;
        return {
            next: () => {
                if (index < this.data.length) {
                    return {
                        value: this.data[index++] + ' ğŸ',
                        done: false
                    };
                }
                return { done: true };
            }
        };
    }
};

// 2. ä½¿ç”¨ for...of éå†
for (let fruit of myIterable) {
    console.log(fruit);
}
        </div>
      </div>

      <!-- å³ä¾§ï¼šå®è·µæ¼”ç¤º -->
      <div class="section">
        <h2>ğŸ”§ åŠ¨æ‰‹å®è·µæ¼”ç¤º</h2>

        <div class="example-box">
          <h3>ç¤ºä¾‹1ï¼šè‡ªå®šä¹‰å¯è¿­ä»£å¯¹è±¡</h3>
          <button onclick="runExample1()">è¿è¡Œç¤ºä¾‹1</button>
          <div class="visualization" id="example1-output">
            <div id="example1-items"></div>
          </div>
        </div>

        <div class="example-box">
          <h3>ç¤ºä¾‹2ï¼šæ‰‹åŠ¨æ§åˆ¶è¿­ä»£å™¨</h3>
          <button onclick="createIterator()">åˆ›å»ºè¿­ä»£å™¨</button>
          <button onclick="nextStep()">ä¸‹ä¸€æ­¥ next()</button>
          <button onclick="resetIterator()">é‡ç½®è¿­ä»£å™¨</button>

          <div class="visualization">
            <div id="iterator-status" class="status">ç­‰å¾…åˆ›å»ºè¿­ä»£å™¨...</div>
            <div id="iterator-output"></div>
            <div id="current-value"></div>
          </div>
        </div>

        <div class="example-box">
          <h3>ç¤ºä¾‹3ï¼šç”Ÿæˆå™¨å‡½æ•°ç®€åŒ–ç‰ˆ</h3>
          <button onclick="runGeneratorExample()">è¿è¡Œç”Ÿæˆå™¨ç¤ºä¾‹</button>
          <div class="output" id="generator-output"></div>
        </div>
      </div>

      <!-- å†…ç½®å¯è¿­ä»£å¯¹è±¡ç¤ºä¾‹ -->
      <div class="section" style="grid-column: 1 / -1">
        <h2>ğŸ“¦ JavaScript å†…ç½®å¯è¿­ä»£å¯¹è±¡</h2>

        <div class="built-in-examples">
          <div class="example-card" onclick="demoArray()">
            <h3>æ•°ç»„ Array</h3>
            <p>[1, 2, 3]</p>
            <small>ç‚¹å‡»æ¼”ç¤º</small>
          </div>

          <div class="example-card" onclick="demoString()">
            <h3>å­—ç¬¦ä¸² String</h3>
            <p>"Hello"</p>
            <small>ç‚¹å‡»æ¼”ç¤º</small>
          </div>

          <div class="example-card" onclick="demoMap()">
            <h3>Map å¯¹è±¡</h3>
            <p>é”®å€¼å¯¹é›†åˆ</p>
            <small>ç‚¹å‡»æ¼”ç¤º</small>
          </div>

          <div class="example-card" onclick="demoSet()">
            <h3>Set å¯¹è±¡</h3>
            <p>å€¼ä¸é‡å¤é›†åˆ</p>
            <small>ç‚¹å‡»æ¼”ç¤º</small>
          </div>
        </div>

        <div class="output" id="built-in-output">é€‰æ‹©ä¸€ä¸ªå†…ç½®å¯¹è±¡è¿›è¡Œæ¼”ç¤º...</div>
      </div>

      <!-- é«˜çº§ç¤ºä¾‹ -->
      <div class="section">
        <h2>ğŸš€ é«˜çº§ç¤ºä¾‹ï¼šèŒƒå›´è¿­ä»£å™¨</h2>

        <div class="example-box">
          <label>èµ·å§‹å€¼: <input type="number" id="start" value="1" style="width: 60px" /></label>
          <label>ç»“æŸå€¼: <input type="number" id="end" value="10" style="width: 60px" /></label>
          <label>æ­¥é•¿: <input type="number" id="step" value="2" style="width: 60px" /></label>
          <button onclick="createRange()">åˆ›å»ºèŒƒå›´è¿­ä»£å™¨</button>
          <button onclick="iterateRange()">éå†èŒƒå›´</button>
        </div>

        <div class="visualization">
          <div id="range-output"></div>
        </div>
      </div>

      <!-- å¼‚æ­¥è¿­ä»£å™¨ç¤ºä¾‹ -->
      <div class="section">
        <h2>â³ å¼‚æ­¥è¿­ä»£å™¨ (ES2018)</h2>

        <div class="explanation">
          <p>å¼‚æ­¥è¿­ä»£å™¨ä½¿ç”¨ <code class="highlight">Symbol.asyncIterator</code> å’Œ <code class="highlight">for await...of</code></p>
        </div>

        <button onclick="runAsyncIterator()">è¿è¡Œå¼‚æ­¥è¿­ä»£å™¨ç¤ºä¾‹</button>
        <div class="output" id="async-output">å¼‚æ­¥ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</div>
      </div>
    </div>

    <script>
      // ç¤ºä¾‹1ï¼šè‡ªå®šä¹‰å¯è¿­ä»£å¯¹è±¡
      const myIterable = {
        data: ["è‹¹æœ", "é¦™è•‰", "æ©™å­", "è‘¡è„", "èŠ’æœ"],
        [Symbol.iterator]() {
          let index = 0;
          return {
            next: () => {
              if (index < this.data.length) {
                return {
                  value: this.data[index++],
                  done: false,
                };
              }
              return { done: true };
            },
          };
        },
      };

      function runExample1() {
        const output = document.getElementById("example1-items");
        output.innerHTML = "";

        for (let fruit of myIterable) {
          const item = document.createElement("div");
          item.className = "output-item";
          item.textContent = `${fruit} ğŸ`;
          output.appendChild(item);
        }
      }

      // ç¤ºä¾‹2ï¼šæ‰‹åŠ¨æ§åˆ¶è¿­ä»£å™¨
      let currentIterator = null;

      function createIterator() {
        const colors = ["ğŸ”´ çº¢è‰²", "ğŸŸ¢ ç»¿è‰²", "ğŸ”µ è“è‰²", "ğŸŸ¡ é»„è‰²", "ğŸŸ£ ç´«è‰²"];
        const colorIterable = {
          [Symbol.iterator]() {
            let index = 0;
            return {
              next: () => {
                if (index < colors.length) {
                  return {
                    value: colors[index++],
                    done: false,
                  };
                }
                return { done: true };
              },
            };
          },
        };

        currentIterator = colorIterable[Symbol.iterator]();
        document.getElementById("iterator-status").className = "status iterating";
        document.getElementById("iterator-status").textContent = 'è¿­ä»£å™¨å·²åˆ›å»ºï¼Œç‚¹å‡»"ä¸‹ä¸€æ­¥"å¼€å§‹è¿­ä»£';
        document.getElementById("iterator-output").innerHTML = "";
        document.getElementById("current-value").innerHTML = "";
      }

      function nextStep() {
        if (!currentIterator) {
          alert("è¯·å…ˆåˆ›å»ºè¿­ä»£å™¨ï¼");
          return;
        }

        const result = currentIterator.next();
        const output = document.getElementById("iterator-output");
        const currentValue = document.getElementById("current-value");

        if (!result.done) {
          const item = document.createElement("div");
          item.className = "output-item";
          item.textContent = result.value;
          output.appendChild(item);

          currentValue.innerHTML = `
                    <strong>å½“å‰è¿”å›çš„å¯¹è±¡:</strong><br>
                    <div class="code-block">
{
  value: "${result.value}",
  done: ${result.done}
}
                    </div>
                `;
        } else {
          document.getElementById("iterator-status").className = "status done";
          document.getElementById("iterator-status").textContent = "è¿­ä»£å®Œæˆï¼done: true";
          currentValue.innerHTML = `
                    <strong>è¿­ä»£ç»“æŸ:</strong><br>
                    <div class="code-block">
{
  value: undefined,
  done: true
}
                    </div>
                `;
        }
      }

      function resetIterator() {
        currentIterator = null;
        document.getElementById("iterator-status").className = "status";
        document.getElementById("iterator-status").textContent = "ç­‰å¾…åˆ›å»ºè¿­ä»£å™¨...";
        document.getElementById("iterator-output").innerHTML = "";
        document.getElementById("current-value").innerHTML = "";
      }

      // ç¤ºä¾‹3ï¼šç”Ÿæˆå™¨å‡½æ•°
      function runGeneratorExample() {
        const generatorIterable = {
          *[Symbol.iterator]() {
            const messages = ["ç¬¬ä¸€ä¸ªå€¼", "ç¬¬äºŒä¸ªå€¼", "ç¬¬ä¸‰ä¸ªå€¼"];
            for (let msg of messages) {
              yield `ğŸ¯ ${msg}`;
            }
          },
        };

        const output = document.getElementById("generator-output");
        output.innerHTML = "";

        for (let item of generatorIterable) {
          output.innerHTML += item + "\n";
        }
      }

      // å†…ç½®å¯è¿­ä»£å¯¹è±¡æ¼”ç¤º
      function demoArray() {
        const arr = [1, 2, 3, 4, 5];
        const output = document.getElementById("built-in-output");
        output.innerHTML = "æ•°ç»„è¿­ä»£ç»“æœ:\n\n";

        for (let item of arr) {
          output.innerHTML += `  ${item} â†’ `;
        }

        output.innerHTML += "\n\nå†…éƒ¨è¿­ä»£å™¨è°ƒç”¨:\n";
        const iterator = arr[Symbol.iterator]();
        let result = iterator.next();
        while (!result.done) {
          output.innerHTML += `  { value: ${result.value}, done: ${result.done} }\n`;
          result = iterator.next();
        }
        output.innerHTML += `  { value: undefined, done: ${result.done} }`;
      }

      function demoString() {
        const str = "Hello ä¸–ç•Œ";
        const output = document.getElementById("built-in-output");
        output.innerHTML = "å­—ç¬¦ä¸²è¿­ä»£ç»“æœ:\n\n";

        for (let char of str) {
          output.innerHTML += `  "${char}" `;
        }
      }

      function demoMap() {
        const map = new Map([
          ["name", "å¼ ä¸‰"],
          ["age", 25],
          ["city", "åŒ—äº¬"],
        ]);

        const output = document.getElementById("built-in-output");
        output.innerHTML = "Map è¿­ä»£ç»“æœ:\n\n";

        for (let [key, value] of map) {
          output.innerHTML += `  ${key} â†’ ${value}\n`;
        }
      }

      function demoSet() {
        const set = new Set([1, 2, 2, 3, 3, 4]);
        const output = document.getElementById("built-in-output");
        output.innerHTML = "Set è¿­ä»£ç»“æœ (è‡ªåŠ¨å»é‡):\n\n";

        for (let value of set) {
          output.innerHTML += `  ${value}\n`;
        }
      }

      // é«˜çº§ç¤ºä¾‹ï¼šèŒƒå›´è¿­ä»£å™¨
      class Range {
        constructor(start, end, step = 1) {
          this.start = start;
          this.end = end;
          this.step = step;
        }

        *[Symbol.iterator]() {
          for (let i = this.start; i <= this.end; i += this.step) {
            yield i;
          }
        }
      }

      let currentRange = null;

      function createRange() {
        const start = parseInt(document.getElementById("start").value);
        const end = parseInt(document.getElementById("end").value);
        const step = parseInt(document.getElementById("step").value);

        currentRange = new Range(start, end, step);
        document.getElementById("range-output").innerHTML = `âœ… å·²åˆ›å»ºèŒƒå›´è¿­ä»£å™¨: ${start} åˆ° ${end}, æ­¥é•¿ ${step}`;
      }

      function iterateRange() {
        if (!currentRange) {
          alert("è¯·å…ˆåˆ›å»ºèŒƒå›´è¿­ä»£å™¨ï¼");
          return;
        }

        const output = document.getElementById("range-output");
        output.innerHTML = "è¿­ä»£ç»“æœ:\n";

        const results = [];
        for (let num of currentRange) {
          results.push(`<span class="output-item">${num}</span>`);
        }

        output.innerHTML += results.join("");
      }

      // å¼‚æ­¥è¿­ä»£å™¨ç¤ºä¾‹
      async function runAsyncIterator() {
        const asyncIterable = {
          data: ["ç¬¬ä¸€æ­¥", "ç¬¬äºŒæ­¥", "ç¬¬ä¸‰æ­¥"],
          async *[Symbol.asyncIterator]() {
            for (let item of this.data) {
              // æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œ
              await new Promise(resolve => setTimeout(resolve, 500));
              yield `â³ ${item} (å»¶è¿Ÿ500ms)`;
            }
          },
        };

        const output = document.getElementById("async-output");
        output.innerHTML = "å¼€å§‹å¼‚æ­¥è¿­ä»£...\n";

        try {
          for await (const value of asyncIterable) {
            output.innerHTML += `${value}\n`;
          }
          output.innerHTML += "âœ… å¼‚æ­¥è¿­ä»£å®Œæˆï¼";
        } catch (error) {
          output.innerHTML += `âŒ é”™è¯¯: ${error.message}`;
        }
      }

      // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
      document.addEventListener("DOMContentLoaded", () => {
        // æ˜¾ç¤ºä¸€äº›åˆå§‹ä¿¡æ¯
        console.log("å¯è¿­ä»£å™¨åè®®ç¤ºä¾‹å·²åŠ è½½");

        // æ¼”ç¤ºæ•°ç»„æ˜¯å¯è¿­ä»£çš„
        const demoArr = [1, 2, 3];
        console.log("æ•°ç»„æœ‰ Symbol.iterator å—?", typeof demoArr[Symbol.iterator] === "function");

        // è·å–æ•°ç»„çš„è¿­ä»£å™¨
        const arrIterator = demoArr[Symbol.iterator]();
        console.log("æ•°ç»„è¿­ä»£å™¨çš„ç¬¬ä¸€æ¬¡ next():", arrIterator.next());
      });
    </script>
  </body>
</html>
