<!DOCTYPE html>
<html>
  <head>
    <title>äº‹ä»¶é˜»å¡æœºåˆ¶è¯¦è§£</title>
    <style>
      #scrollArea {
        height: 500px;
        overflow-y: scroll;
        border: 2px solid #333;
        padding: 20px;
      }
      .content {
        height: 2000px;
        background: linear-gradient(to bottom, #f0f0f0, #e0e0e0);
      }
      .log {
        margin: 10px;
        padding: 10px;
        background: #fff;
        border: 1px solid #ccc;
        font-family: monospace;
      }
    </style>
  </head>
  <body>
    <div id="scrollArea">
      <div class="content">
        <h2>æ»šåŠ¨æµ‹è¯•åŒºåŸŸ</h2>
        <p>å°è¯•å¿«é€Ÿæ»šåŠ¨è¿™ä¸ªåŒºåŸŸï¼Œè§‚å¯Ÿä¸åŒæ¨¡å¼ä¸‹çš„æ€§èƒ½è¡¨ç°</p>
      </div>
    </div>

    <button onclick="enableBlockingMode()">å¯ç”¨é˜»å¡æ¨¡å¼</button>
    <button onclick="enablePassiveMode()">å¯ç”¨ Passive æ¨¡å¼</button>
    <button onclick="clearListeners()">æ¸…é™¤ç›‘å¬å™¨</button>

    <div class="log" id="performanceLog"></div>

    <script>
      const scrollArea = document.getElementById("scrollArea");
      const performanceLog = document.getElementById("performanceLog");
      let currentListener = null;

      function logPerformance(message) {
        performanceLog.innerHTML += `<div>${new Date().toLocaleTimeString()}: ${message}</div>`;
        performanceLog.scrollTop = performanceLog.scrollHeight;
      }

      function simulateHeavyComputation() {
        // æ¨¡æ‹Ÿç¹é‡çš„ JavaScript è®¡ç®—
        let result = 0;
        const startTime = performance.now();

        for (let i = 0; i < 500000000; i++) {
          result += Math.sin(i) * Math.cos(i);
        }

        const endTime = performance.now();
        return endTime - startTime;
      }

      // å¯ç”¨é˜»å¡æ¨¡å¼
      function enableBlockingMode() {
        clearListeners();
        logPerformance("ğŸš¨ å¯ç”¨é˜»å¡æ¨¡å¼");

        currentListener = function (event) {
          const computationTime = simulateHeavyComputation();
          logPerformance(`é˜»å¡æ¨¡å¼: è®¡ç®—è€—æ—¶ ${computationTime.toFixed(2)}ms, æ»šåŠ¨è¢«é˜»å¡`);
        };

        scrollArea.addEventListener("scroll", currentListener, { passive: false });
        // é»˜è®¤ { passive: false }ï¼Œæµè§ˆå™¨å¿…é¡»ç­‰å¾…å‡½æ•°æ‰§è¡Œå®Œæ¯•
      }

      // å¯ç”¨ Passive æ¨¡å¼
      function enablePassiveMode() {
        clearListeners();
        logPerformance("âœ… å¯ç”¨ Passive æ¨¡å¼");

        currentListener = function (event) {
          const computationTime = simulateHeavyComputation();
          logPerformance(`Passiveæ¨¡å¼: è®¡ç®—è€—æ—¶ ${computationTime.toFixed(2)}ms, æ»šåŠ¨ä¸å—å½±å“`);
        };

        scrollArea.addEventListener("scroll", currentListener, { passive: true });
        // æµè§ˆå™¨çŸ¥é“ä¸ä¼šè°ƒç”¨ preventDefault()ï¼Œç«‹å³æ»šåŠ¨
      }

      // æ¸…é™¤ç›‘å¬å™¨
      function clearListeners() {
        if (currentListener) {
          scrollArea.removeEventListener("scroll", currentListener);
          currentListener = null;
        }
        logPerformance("æ¸…é™¤æ‰€æœ‰ç›‘å¬å™¨");
      }

      // åˆå§‹çŠ¶æ€
      logPerformance("è¯·é€‰æ‹©æµ‹è¯•æ¨¡å¼");
    </script>
  </body>
</html>
