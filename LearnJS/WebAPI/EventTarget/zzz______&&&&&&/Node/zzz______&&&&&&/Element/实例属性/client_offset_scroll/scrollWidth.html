<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>scrollWidth å±æ€§è¯¦è§£</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        color: #333;
        line-height: 1.6;
        padding: 20px;
        min-height: 100vh;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      header {
        text-align: center;
        margin-bottom: 40px;
        padding: 30px;
        background: white;
        border-radius: 15px;
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
      }

      h1 {
        color: #2c3e50;
        margin-bottom: 15px;
        font-size: 2.5rem;
      }

      .subtitle {
        color: #7f8c8d;
        font-size: 1.3rem;
        max-width: 800px;
        margin: 0 auto;
      }

      .content {
        display: grid;
        grid-template-columns: 100%;
        margin-bottom: 40px;
      }

      .demo-section {
        background: white;
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
        margin-bottom: 40px;
      }

      .explanation-section {
        background: white;
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
      }

      h2 {
        color: #2c3e50;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 3px solid #1abc9c;
      }

      h3 {
        color: #2c3e50;
        margin: 25px 0 15px 0;
      }

      .demo-container {
        position: relative;
        width: 100%;
        height: 400px;
        border: 2px solid #34495e;
        margin: 25px 0;
        background: #ecf0f1;
        padding: 20px;
        border-radius: 10px;
        overflow: hidden;
      }

      .scroll-element {
        width: 100%;
        height: 100%;
        overflow: auto;
        border: 2px solid #1abc9c;
        border-radius: 8px;
        background: white;
        position: relative;
      }

      .scroll-content {
        min-width: 1200px;
        padding: 20px;
        background: linear-gradient(90deg, #3498db11 0%, #2ecc7111 25%, #e74c3c11 50%, #f39c1211 75%, #9b59b611 100%);
      }

      .content-column {
        display: inline-block;
        width: 280px;
        height: 340px;
        margin: 0 15px;
        padding: 20px;
        border-radius: 8px;
        vertical-align: top;
        border: 2px solid;
        position: relative;
      }

      .column-1 {
        background: #3498db33;
        border-color: #3498db;
      }
      .column-2 {
        background: #2ecc7133;
        border-color: #2ecc71;
      }
      .column-3 {
        background: #e74c3c33;
        border-color: #e74c3c;
      }
      .column-4 {
        background: #f39c1233;
        border-color: #f39c12;
      }
      .column-5 {
        background: #9b59b633;
        border-color: #9b59b6;
      }

      .dimension-visualization {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        pointer-events: none;
        z-index: 5;
      }

      .scrollWidth-highlight {
        position: absolute;
        top: 0;
        bottom: 0;
        background: rgba(26, 188, 156, 0.2);
        border: 2px dashed #1abc9c;
        transition: width 0.3s ease;
      }

      .clientWidth-highlight {
        position: absolute;
        top: 0;
        bottom: 0;
        background: rgba(52, 152, 219, 0.2);
        border: 2px solid #3498db;
        width: 100%;
      }

      .dimension-label {
        position: absolute;
        background: rgba(255, 255, 255, 0.95);
        padding: 6px 12px;
        border-radius: 4px;
        font-size: 0.8rem;
        font-weight: bold;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        white-space: nowrap;
      }

      .scroll-indicator {
        position: absolute;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(26, 188, 156, 0.9);
        color: white;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 0.9rem;
        font-weight: bold;
        z-index: 10;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      }

      .controls {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
        margin: 20px 0;
      }

      button {
        padding: 12px 15px;
        background: #1abc9c;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 0.9rem;
        font-weight: 600;
      }

      button:hover {
        background: #16a085;
        transform: translateY(-2px);
      }

      button.secondary {
        background: #3498db;
      }

      button.secondary:hover {
        background: #2980b9;
      }

      .property-display {
        background: #2c3e50;
        color: white;
        padding: 20px;
        border-radius: 10px;
        margin: 20px 0;
      }

      .property-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin: 10px 0;
        padding: 8px 12px;
        background: #34495e;
        border-radius: 6px;
      }

      .property-name {
        font-weight: bold;
        font-size: 1.1rem;
      }

      .property-value {
        font-family: "Courier New", monospace;
        font-size: 1.2rem;
        color: #f1c40f;
        font-weight: bold;
      }

      .content-controls {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        margin: 20px 0;
      }

      .control-group {
        margin: 15px 0;
      }

      .control-label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #2c3e50;
      }

      .range-slider {
        width: 100%;
        height: 6px;
        border-radius: 3px;
        background: #ddd;
        outline: none;
        -webkit-appearance: none;
      }

      .range-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: #1abc9c;
        cursor: pointer;
      }

      .range-value {
        text-align: center;
        font-weight: bold;
        color: #1abc9c;
        margin-top: 5px;
      }

      .width-comparison {
        display: flex;
        justify-content: space-around;
        margin: 20px 0;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 8px;
      }

      .width-item {
        text-align: center;
        padding: 10px;
        flex: 1;
      }

      .width-value {
        font-size: 1.2rem;
        font-weight: bold;
        color: #2c3e50;
      }

      .width-label {
        font-size: 0.8rem;
        color: #7f8c8d;
        margin-top: 5px;
      }

      .comparison-table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
        background: white;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .comparison-table th {
        background: #1abc9c;
        color: white;
        padding: 12px 15px;
        text-align: left;
      }

      .comparison-table td {
        padding: 10px 15px;
        border-bottom: 1px solid #ecf0f1;
      }

      .comparison-table tr:nth-child(even) {
        background: #f8f9fa;
      }

      .code-block {
        background: #2c3e50;
        color: #ecf0f1;
        padding: 20px;
        border-radius: 10px;
        font-family: "Courier New", monospace;
        margin: 20px 0;
        overflow-x: auto;
        font-size: 0.9rem;
        line-height: 1.5;
        white-space: pre;
      }

      .special-cases {
        background: #fff9e6;
        padding: 20px;
        border-radius: 10px;
        border-left: 4px solid #f1c40f;
        margin: 20px 0;
      }

      .case-example {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        margin: 10px 0;
        border: 1px solid #e9ecef;
      }

      .overflow-demo {
        background: #e8f6f3;
        padding: 15px;
        border-radius: 8px;
        margin: 15px 0;
        border: 2px solid #1abc9c;
      }

      @media (max-width: 968px) {
        .content {
          grid-template-columns: 1fr;
        }

        .controls {
          grid-template-columns: 1fr;
        }

        .width-comparison {
          flex-direction: column;
          gap: 10px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>scrollWidth å±æ€§è¯¦è§£</h1>
        <p class="subtitle">æ·±å…¥ç†è§£ scrollWidth çš„è®¡ç®—æ–¹å¼ã€åº”ç”¨åœºæ™¯å’Œç‰¹æ®Šè¡Œä¸º</p>
      </header>

      <div class="content">
        <div class="demo-section">
          <h2>äº¤äº’æ¼”ç¤º</h2>
          <p>è°ƒæ•´å†…å®¹å®½åº¦ï¼Œè§‚å¯Ÿ scrollWidth å€¼çš„å˜åŒ–</p>

          <div class="demo-container">
            <div class="scroll-element" id="scrollElement">
              <div class="scroll-indicator" id="scrollIndicator">scrollWidth: <span id="scrollWidthValue">1200</span>px</div>
              <div class="dimension-visualization" id="dimensionVisualization">
                <div class="scrollWidth-highlight" id="scrollWidthHighlight"></div>
                <div class="clientWidth-highlight" id="clientWidthHighlight"></div>
              </div>
              <div class="scroll-content" id="scrollContent">
                <div class="content-column column-1">
                  <h3>ç¬¬ä¸€åˆ—</h3>
                  <p>scrollWidth = å†…å®¹æ€»å®½åº¦</p>
                  <p>åŒ…æ‹¬æ‰€æœ‰å¯è§å’Œä¸å¯è§å†…å®¹</p>
                  <div class="overflow-demo">
                    <p>è¿™ä¸ªåŒºåŸŸæ¼”ç¤ºäº† scrollWidth çš„è®¡ç®—</p>
                    <p>å°è¯•è°ƒæ•´å†…å®¹å®½åº¦è§‚å¯Ÿå˜åŒ–</p>
                  </div>
                </div>
                <div class="content-column column-2">
                  <h3>ç¬¬äºŒåˆ—</h3>
                  <p>åŒ…å«å†…è¾¹è·</p>
                  <p>ä¸åŒ…å«è¾¹æ¡†å’Œå¤–è¾¹è·</p>
                  <div style="margin-top: 20px; padding: 15px; background: rgba(255, 255, 255, 0.5); border-radius: 6px">
                    <p>å†…è¾¹è·å½±å“ scrollWidth</p>
                    <p>ä½†è¾¹æ¡†ä¸å½±å“</p>
                  </div>
                </div>
                <div class="content-column column-3">
                  <h3>ç¬¬ä¸‰åˆ—</h3>
                  <p>ä¼ªå…ƒç´ åŒ…å«åœ¨å†…</p>
                  <p>::before å’Œ ::after</p>
                  <div style="margin-top: 20px; position: relative">
                    <div style="padding: 10px; background: rgba(255, 255, 255, 0.5); border-radius: 4px">
                      <p>ä¼ªå…ƒç´ å†…å®¹</p>
                      <p>ä¹Ÿä¼šè®¡å…¥ scrollWidth</p>
                    </div>
                  </div>
                </div>
                <div class="content-column column-4">
                  <h3>ç¬¬å››åˆ—</h3>
                  <p>éšè—å†…å®¹çš„å½±å“</p>
                  <p>display: none ä¸åŒ…å«</p>
                  <div style="margin-top: 20px">
                    <div class="hidden-content" style="display: none; padding: 10px; background: rgba(255, 255, 255, 0.5)">
                      <p>è¿™ä¸ªéšè—å†…å®¹ä¸è®¡å…¥ scrollWidth</p>
                    </div>
                    <div class="visible-content" style="padding: 10px; background: rgba(255, 255, 255, 0.5); border-radius: 4px">
                      <p>å¯è§å†…å®¹è®¡å…¥ scrollWidth</p>
                    </div>
                  </div>
                </div>
                <div class="content-column column-5">
                  <h3>ç¬¬äº”åˆ—</h3>
                  <p>overflow çš„å½±å“</p>
                  <p>hidden vs visible</p>
                  <div style="margin-top: 20px; padding: 15px; background: rgba(255, 255, 255, 0.5); border-radius: 6px">
                    <p>overflow ä¸å½±å“ scrollWidth</p>
                    <p>ä½†å½±å“æ˜¯å¦éœ€è¦æ»šåŠ¨æ¡</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="width-comparison">
            <div class="width-item">
              <div class="width-value" id="scrollWidthDisplay">1200px</div>
              <div class="width-label">scrollWidth</div>
            </div>
            <div class="width-item">
              <div class="width-value" id="clientWidthDisplay">600px</div>
              <div class="width-label">clientWidth</div>
            </div>
            <div class="width-item">
              <div class="width-value" id="offsetWidthDisplay">604px</div>
              <div class="width-label">offsetWidth</div>
            </div>
          </div>

          <div class="content-controls">
            <div class="control-group">
              <label class="control-label">å†…å®¹æ€»å®½åº¦:</label>
              <input type="range" min="800" max="2000" value="1200" class="range-slider" id="contentWidthSlider" />
              <div class="range-value" id="contentWidthValue">1200px</div>
            </div>

            <div class="control-group">
              <label class="control-label">å†…è¾¹è·:</label>
              <input type="range" min="10" max="50" value="20" class="range-slider" id="paddingSlider" />
              <div class="range-value" id="paddingValue">20px</div>
            </div>

            <div class="control-group">
              <label class="control-label">åˆ—é—´è·:</label>
              <input type="range" min="5" max="30" value="15" class="range-slider" id="marginSlider" />
              <div class="range-value" id="marginValue">15px</div>
            </div>
          </div>

          <div class="controls">
            <button onclick="addNewColumn()">æ·»åŠ æ–°åˆ—</button>
            <button onclick="removeColumn()">ç§»é™¤åˆ—</button>
            <button onclick="toggleOverflow()">åˆ‡æ¢overflow</button>
            <button class="secondary" onclick="addPseudoElement()">æ·»åŠ ä¼ªå…ƒç´ </button>
            <button class="secondary" onclick="toggleHiddenContent()">åˆ‡æ¢éšè—å†…å®¹</button>
            <button onclick="resetAll()">é‡ç½®æ‰€æœ‰</button>
          </div>

          <div class="property-display">
            <h3 style="color: white; margin-top: 0">å®½åº¦å±æ€§å¯¹æ¯”</h3>
            <div class="property-item">
              <span class="property-name">scrollWidth:</span>
              <span class="property-value" id="scrollWidthVal">1200px</span>
            </div>
            <div class="property-item">
              <span class="property-name">clientWidth:</span>
              <span class="property-value" id="clientWidthVal">600px</span>
            </div>
            <div class="property-item">
              <span class="property-name">offsetWidth:</span>
              <span class="property-value" id="offsetWidthVal">604px</span>
            </div>
            <div class="property-item">
              <span class="property-name">æ˜¯å¦éœ€è¦æ°´å¹³æ»šåŠ¨:</span>
              <span class="property-value" id="needsScrollVal">æ˜¯</span>
            </div>
            <div class="property-item">
              <span class="property-name">æº¢å‡ºå®½åº¦:</span>
              <span class="property-value" id="overflowWidthVal">600px</span>
            </div>
          </div>
        </div>

        <div class="explanation-section">
          <h2>scrollWidth è¯¦è§£</h2>

          <div class="special-cases">
            <h3>ğŸ“Œ scrollWidth æ ¸å¿ƒå®šä¹‰</h3>
            <p><strong>scrollWidth = å…ƒç´ å†…å®¹çš„æ€»å®½åº¦ï¼ŒåŒ…æ‹¬å› æº¢å‡ºè€Œä¸å¯è§çš„éƒ¨åˆ†</strong></p>
            <p>è¿™æ˜¯ä¸€ä¸ªåªè¯»å±æ€§ï¼Œè¿”å›å…ƒç´ å†…å®¹çš„å®Œæ•´å®½åº¦ï¼Œä¸è€ƒè™‘å¯è§†åŒºåŸŸé™åˆ¶ã€‚</p>
          </div>

          <h3>åŸºæœ¬è®¡ç®—å…¬å¼</h3>
          <div class="code-block">
// scrollWidth åŒ…å«çš„å†…å®¹
element.scrollWidth = æ‰€æœ‰å†…å®¹å®½åº¦ + å·¦å³å†…è¾¹è·

// ä¸åŒ…å«çš„å†…å®¹
// - è¾¹æ¡† (border)
// - å¤–è¾¹è· (margin)
// - æ»šåŠ¨æ¡

// éªŒè¯è®¡ç®—
const element = document.getElementById('scrollElement');
const contentWidth = Array.from(element.children)
    .reduce((total, child) => total + child.offsetWidth, 0);
const paddingLeft = parseInt(getComputedStyle(element).paddingLeft);
const paddingRight = parseInt(getComputedStyle(element).paddingRight);

console.log('è®¡ç®—çš„æ€»å®½åº¦:', contentWidth + paddingLeft + paddingRight);
console.log('å®é™…çš„scrollWidth:', element.scrollWidth);
          </div>

          <h3>ä¸å…¶ä»–å®½åº¦å±æ€§çš„å¯¹æ¯”</h3>
          <table class="comparison-table">
            <thead>
              <tr>
                <th>å±æ€§</th>
                <th>æè¿°</th>
                <th>åŒ…å«å†…å®¹</th>
                <th>ä¸åŒ…å«å†…å®¹</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>scrollWidth</strong></td>
                <td>å†…å®¹æ€»å®½åº¦</td>
                <td>æ‰€æœ‰å†…å®¹ + å†…è¾¹è·</td>
                <td>è¾¹æ¡†ã€å¤–è¾¹è·ã€æ»šåŠ¨æ¡</td>
              </tr>
              <tr>
                <td>clientWidth</td>
                <td>å¯è§†åŒºåŸŸå®½åº¦</td>
                <td>å¯è§†å†…å®¹ + å†…è¾¹è·</td>
                <td>è¾¹æ¡†ã€æ»šåŠ¨æ¡ã€æº¢å‡ºå†…å®¹</td>
              </tr>
              <tr>
                <td>offsetWidth</td>
                <td>å…ƒç´ æ•´ä½“å®½åº¦</td>
                <td>å†…å®¹ + å†…è¾¹è· + è¾¹æ¡† + æ»šåŠ¨æ¡</td>
                <td>å¤–è¾¹è·</td>
              </tr>
              <tr>
                <td>getBoundingClientRect().width</td>
                <td>æ¸²æŸ“å®½åº¦</td>
                <td>å†…å®¹ + å†…è¾¹è· + è¾¹æ¡†</td>
                <td>å¤–è¾¹è·ã€æ»šåŠ¨æ¡</td>
              </tr>
            </tbody>
          </table>

          <h3>ç‰¹æ®Šæƒ…å†µå’Œæ³¨æ„äº‹é¡¹</h3>

          <div class="case-example">
            <h4>æƒ…å†µ 1: ä¼ªå…ƒç´ çš„å½±å“</h4>
            <p>ä¼ªå…ƒç´ (::before, ::after)çš„å†…å®¹ä¼šè®¡å…¥ scrollWidthï¼š</p>
            <div class="code-block">
// CSS ä¼ªå…ƒç´ 
.element::before {
    content: "å‰ç¼€å†…å®¹";
    display: inline-block;
    width: 100px;
}

.element::after {
    content: "åç¼€å†…å®¹";
    display: inline-block;
    width: 100px;
}

// JavaScript æ£€æµ‹
const element = document.querySelector('.element');
console.log('åŒ…å«ä¼ªå…ƒç´ çš„scrollWidth:', element.scrollWidth);

// ä¼ªå…ƒç´ ä¼šå¢åŠ scrollWidthçš„å€¼
// å³ä½¿å®ƒä»¬åœ¨è§†è§‰ä¸Šå¯èƒ½ä¸å¯è§
            </div>
          </div>

          <div class="case-example">
            <h4>æƒ…å†µ 2: éšè—å†…å®¹çš„å½±å“</h4>
            <p>ä¸åŒéšè—æ–¹å¼å¯¹ scrollWidth çš„å½±å“ï¼š</p>
            <div class="code-block">
const element = document.getElementById('test');

// display: none çš„å†…å®¹ä¸è®¡å…¥
element.querySelector('.hidden').style.display = 'none';
console.log('éšè—display:noneåçš„scrollWidth:', element.scrollWidth);

// visibility: hidden çš„å†…å®¹ä¼šè®¡å…¥
element.querySelector('.invisible').style.visibility = 'hidden';
console.log('éšè—visibility:hiddenåçš„scrollWidth:', element.scrollWidth);

// opacity: 0 çš„å†…å®¹ä¼šè®¡å…¥
element.querySelector('.transparent').style.opacity = 0;
console.log('é€æ˜åŒ–åçš„scrollWidth:', element.scrollWidth);

// ç»“è®ºï¼šåªæœ‰å®Œå…¨ä»æ–‡æ¡£æµä¸­ç§»é™¤çš„å†…å®¹æ‰ä¸å½±å“scrollWidth
            </div>
          </div>

          <div class="case-example">
            <h4>æƒ…å†µ 3: å†…è”å…ƒç´ å’Œæ–‡æœ¬å†…å®¹</h4>
            <p>å¯¹äºå†…è”å…ƒç´ ï¼ŒscrollWidth åæ˜ æ–‡æœ¬å†…å®¹çš„å®é™…å®½åº¦ï¼š</p>
            <div class="code-block">
// å†…è”å…ƒç´ çš„scrollWidth
const span = document.createElement('span');
span.textContent = 'è¿™æ˜¯ä¸€ä¸ªå¾ˆé•¿çš„æ–‡æœ¬å†…å®¹ï¼Œä¼šè‡ªåŠ¨æ¢è¡Œå—ï¼Ÿ';
document.body.appendChild(span);

console.log('å†…è”å…ƒç´ çš„scrollWidth:', span.scrollWidth);
console.log('å†…è”å…ƒç´ çš„offsetWidth:', span.offsetWidth);

// å¯¹äºè‡ªåŠ¨æ¢è¡Œçš„æ–‡æœ¬ï¼ŒscrollWidthè¡¨ç¤ºå•è¡Œæœ€å¤§å®½åº¦
const div = document.createElement('div');
div.style.width = '200px';
div.textContent = 'è¿™ä¸ªæ–‡æœ¬ä¼šåœ¨200pxå®½åº¦å†…è‡ªåŠ¨æ¢è¡Œ';
document.body.appendChild(div);

console.log('è‡ªåŠ¨æ¢è¡Œå…ƒç´ çš„scrollWidth:', div.scrollWidth); // 200px
console.log('æ–‡æœ¬å†…å®¹çš„å®é™…å®½åº¦:', div.scrollWidth); // å¯èƒ½å°äºæ–‡æœ¬å®é™…å®½åº¦
            </div>
          </div>

          <h3>å®é™…åº”ç”¨åœºæ™¯</h3>
          <div class="code-block">
// åº”ç”¨ 1: æ£€æµ‹æ˜¯å¦éœ€è¦æ°´å¹³æ»šåŠ¨æ¡
function needsHorizontalScrollbar(element) {
    return element.scrollWidth > element.clientWidth;
}

// åº”ç”¨ 2: è‡ªå®šä¹‰æ»šåŠ¨æ¡å®ç°
function createCustomScrollbar(container) {
    const scrollbar = document.createElement('div');
    scrollbar.className = 'custom-scrollbar';
    
    function updateScrollbar() {
        const scrollWidth = container.scrollWidth;
        const clientWidth = container.clientWidth;
        
        if (scrollWidth > clientWidth) {
            // è®¡ç®—æ»šåŠ¨æ¡ thumb çš„å®½åº¦
            const thumbWidth = (clientWidth / scrollWidth) * clientWidth;
            const thumbPosition = (container.scrollLeft / scrollWidth) * clientWidth;
            
            scrollbar.style.display = 'block';
            scrollbar.querySelector('.thumb').style.width = thumbWidth + 'px';
            scrollbar.querySelector('.thumb').style.left = thumbPosition + 'px';
        } else {
            scrollbar.style.display = 'none';
        }
    }
    
    container.addEventListener('scroll', updateScrollbar);
    window.addEventListener('resize', updateScrollbar);
    updateScrollbar();
    
    return scrollbar;
}

// åº”ç”¨ 3: å“åº”å¼è¡¨æ ¼å¤„ç†
function setupResponsiveTable(table) {
    const container = table.parentElement;
    
    function checkTableOverflow() {
        const tableWidth = table.scrollWidth;
        const containerWidth = container.clientWidth;
        
        if (tableWidth > containerWidth) {
            // è¡¨æ ¼æº¢å‡ºï¼Œæ·»åŠ æ°´å¹³æ»šåŠ¨æç¤º
            container.classList.add('table-overflow');
            
            // è®¡ç®—æº¢å‡ºæ¯”ä¾‹
            const overflowRatio = (tableWidth - containerWidth) / tableWidth;
            console.log(`è¡¨æ ¼æº¢å‡ºæ¯”ä¾‹: ${(overflowRatio * 100).toFixed(1)}%`);
        } else {
            container.classList.remove('table-overflow');
        }
    }
    
    // ç›‘å¬å˜åŒ–
    const observer = new MutationObserver(checkTableOverflow);
    observer.observe(table, { 
        childList: true, 
        subtree: true, 
        characterData: true 
    });
    
    window.addEventListener('resize', checkTableOverflow);
    checkTableOverflow();
}

// åº”ç”¨ 4: åŠ¨æ€å†…å®¹åŠ è½½æ£€æµ‹
function setupDynamicContentLoader(container, loadCallback) {
    let isLoading = false;
    
    function checkContentSize() {
        const contentWidth = container.scrollWidth;
        const visibleWidth = container.clientWidth;
        
        // å¦‚æœå†…å®¹å®½åº¦çªç„¶å¤§å¹…å¢åŠ ï¼Œå¯èƒ½æ˜¯æœ‰æ–°å†…å®¹åŠ è½½
        if (contentWidth > visibleWidth * 2 && !isLoading) {
            isLoading = true;
            console.log('æ£€æµ‹åˆ°å¤§é‡æ–°å†…å®¹ï¼Œä¼˜åŒ–åŠ è½½...');
            
            // å¯ä»¥åœ¨è¿™é‡Œè¿›è¡Œæ‡’åŠ è½½ä¼˜åŒ–
            optimizeContentLoading(container);
        }
    }
    
    // ä½¿ç”¨ MutationObserver ç›‘å¬å†…å®¹å˜åŒ–
    const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
            if (mutation.type === 'childList' || mutation.type === 'characterData') {
                checkContentSize();
            }
        });
    });
    
    observer.observe(container, {
        childList: true,
        subtree: true,
        characterData: true
    });
}

// åº”ç”¨ 5: æ–‡æœ¬çœç•¥å·æ£€æµ‹
function needsEllipsis(element) {
    const scrollWidth = element.scrollWidth;
    const clientWidth = element.clientWidth;
    const offsetWidth = element.offsetWidth;
    
    // å¦‚æœå†…å®¹å®½åº¦å¤§äºå®¹å™¨å®½åº¦ï¼Œéœ€è¦æ˜¾ç¤ºçœç•¥å·
    return scrollWidth > clientWidth;
}

// åº”ç”¨ 6: æ°´å¹³è½®æ’­å›¾çŠ¶æ€æ£€æµ‹
class HorizontalCarousel {
    constructor(container) {
        this.container = container;
        this.items = Array.from(container.children);
        this.updateMetrics();
    }
    
    updateMetrics() {
        this.scrollWidth = this.container.scrollWidth;
        this.clientWidth = this.container.clientWidth;
        this.canScroll = this.scrollWidth > this.clientWidth;
        this.totalItems = this.items.length;
        
        console.log(`è½®æ’­å›¾çŠ¶æ€: ${this.totalItems}ä¸ªé¡¹ç›®, å¯æ»šåŠ¨: ${this.canScroll}`);
    }
    
    getVisibleItemCount() {
        const itemWidth = this.items[0].offsetWidth;
        return Math.floor(this.clientWidth / itemWidth);
    }
    
    getTotalPossibleItems() {
        const itemWidth = this.items[0].offsetWidth;
        return Math.floor(this.scrollWidth / itemWidth);
    }
}

// åº”ç”¨ 7: æ‰“å°å†…å®¹æ£€æµ‹
function checkPrintContent(element) {
    const naturalWidth = element.scrollWidth;
    const containerWidth = element.clientWidth;
    
    if (naturalWidth > containerWidth) {
        console.warn('å†…å®¹å¯èƒ½ä¸é€‚åˆæ‰“å°ï¼Œå»ºè®®è°ƒæ•´å¸ƒå±€');
        console.log(`å†…å®¹å®½åº¦: ${naturalWidth}px, å®¹å™¨å®½åº¦: ${containerWidth}px`);
        
        // æä¾›æ‰“å°ä¼˜åŒ–å»ºè®®
        suggestPrintOptimizations(naturalWidth, containerWidth);
    }
}
          </div>

          <h3>æ€§èƒ½ä¼˜åŒ–å’Œæœ€ä½³å®è·µ</h3>
          <div class="special-cases">
            <p><strong>scrollWidth ä¼šè§¦å‘é‡æ’ï¼Œä½¿ç”¨æ—¶éœ€è¦æ³¨æ„ï¼š</strong></p>
            <ul>
              <li>é¿å…åœ¨å¾ªç¯ä¸­é¢‘ç¹è¯»å– scrollWidth</li>
              <li>ä½¿ç”¨ç¼“å­˜æœºåˆ¶å­˜å‚¨è®¡ç®—ç»“æœ</li>
              <li>åœ¨æ‰¹é‡æ“ä½œåä¸€æ¬¡æ€§è¯»å–</li>
              <li>ä½¿ç”¨ ResizeObserver ç›‘å¬å°ºå¯¸å˜åŒ–</li>
            </ul>
            <div class="code-block">
// ä¸å¥½çš„åšæ³• - é¢‘ç¹è¯»å–
function badExample() {
    for (let i = 0; i < elements.length; i++) {
        if (elements[i].scrollWidth > threshold) {
            // æ¯æ¬¡å¾ªç¯éƒ½è§¦å‘é‡æ’
            processElement(elements[i]);
        }
    }
}

// å¥½çš„åšæ³• - æ‰¹é‡è¯»å–
function goodExample() {
    // ä¸€æ¬¡æ€§è¯»å–æ‰€æœ‰éœ€è¦çš„å°ºå¯¸
    const measurements = elements.map(el => ({
        element: el,
        scrollWidth: el.scrollWidth,
        clientWidth: el.clientWidth
    }));
    
    // ç„¶åè¿›è¡Œå¤„ç†
    measurements.forEach(({ element, scrollWidth, clientWidth }) => {
        if (scrollWidth > clientWidth) {
            processElement(element);
        }
    });
}

// ä½¿ç”¨ ResizeObserver ç›‘å¬å˜åŒ–
const resizeObserver = new ResizeObserver(entries => {
    entries.forEach(entry => {
        const { scrollWidth, clientWidth } = entry.target;
        if (scrollWidth !== entry.target._cachedScrollWidth) {
            entry.target._cachedScrollWidth = scrollWidth;
            onScrollWidthChange(entry.target, scrollWidth, clientWidth);
        }
    });
});

resizeObserver.observe(element);
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // è·å–DOMå…ƒç´ 
      const scrollElement = document.getElementById("scrollElement");
      const scrollContent = document.getElementById("scrollContent");
      const scrollIndicator = document.getElementById("scrollIndicator");
      const scrollWidthValue = document.getElementById("scrollWidthValue");
      const dimensionVisualization = document.getElementById("dimensionVisualization");

      // è·å–æ˜¾ç¤ºå…ƒç´ 
      const scrollWidthVal = document.getElementById("scrollWidthVal");
      const clientWidthVal = document.getElementById("clientWidthVal");
      const offsetWidthVal = document.getElementById("offsetWidthVal");
      const needsScrollVal = document.getElementById("needsScrollVal");
      const overflowWidthVal = document.getElementById("overflowWidthVal");
      const scrollWidthDisplay = document.getElementById("scrollWidthDisplay");
      const clientWidthDisplay = document.getElementById("clientWidthDisplay");
      const offsetWidthDisplay = document.getElementById("offsetWidthDisplay");

      // è·å–æ§åˆ¶å…ƒç´ 
      const contentWidthSlider = document.getElementById("contentWidthSlider");
      const paddingSlider = document.getElementById("paddingSlider");
      const marginSlider = document.getElementById("marginSlider");
      const contentWidthValue = document.getElementById("contentWidthValue");
      const paddingValue = document.getElementById("paddingValue");
      const marginValue = document.getElementById("marginValue");

      // çŠ¶æ€å˜é‡
      let columnCount = 5;
      let hasPseudoElement = false;
      let hasHiddenContent = false;

      // æ›´æ–°å±æ€§æ˜¾ç¤º
      function updateProperties() {
        const scrollWidth = scrollElement.scrollWidth;
        const clientWidth = scrollElement.clientWidth;
        const offsetWidth = scrollElement.offsetWidth;
        const needsScroll = scrollWidth > clientWidth;
        const overflowWidth = Math.max(0, scrollWidth - clientWidth);

        scrollWidthVal.textContent = scrollWidth + "px";
        clientWidthVal.textContent = clientWidth + "px";
        offsetWidthVal.textContent = offsetWidth + "px";
        needsScrollVal.textContent = needsScroll ? "æ˜¯" : "å¦";
        overflowWidthVal.textContent = overflowWidth + "px";

        // æ›´æ–°æŒ‡ç¤ºå™¨
        scrollWidthValue.textContent = scrollWidth;

        // æ›´æ–°æ¯”è¾ƒæ˜¾ç¤º
        scrollWidthDisplay.textContent = scrollWidth + "px";
        clientWidthDisplay.textContent = clientWidth + "px";
        offsetWidthDisplay.textContent = offsetWidth + "px";

        // æ›´æ–°å¯è§†åŒ–
        updateVisualization();
      }

      // æ›´æ–°å¯è§†åŒ–
      function updateVisualization() {
        const scrollWidth = scrollElement.scrollWidth;
        const clientWidth = scrollElement.clientWidth;

        const scrollWidthHighlight = document.getElementById("scrollWidthHighlight");
        const clientWidthHighlight = document.getElementById("clientWidthHighlight");

        scrollWidthHighlight.style.width = scrollWidth + "px";

        // æ›´æ–°æ ‡ç­¾
        updateDimensionLabels();
      }

      // æ›´æ–°å°ºå¯¸æ ‡ç­¾
      function updateDimensionLabels() {
        // æ¸…é™¤æ—§æ ‡ç­¾
        document.querySelectorAll(".dimension-label").forEach(label => label.remove());

        const scrollWidth = scrollElement.scrollWidth;
        const clientWidth = scrollElement.clientWidth;

        // scrollWidth æ ‡ç­¾
        const scrollWidthLabel = document.createElement("div");
        scrollWidthLabel.className = "dimension-label";
        scrollWidthLabel.style.top = "50%";
        scrollWidthLabel.style.left = scrollWidth / 2 - 60 + "px";
        scrollWidthLabel.textContent = `scrollWidth: ${scrollWidth}px`;
        dimensionVisualization.appendChild(scrollWidthLabel);

        // clientWidth æ ‡ç­¾
        const clientWidthLabel = document.createElement("div");
        clientWidthLabel.className = "dimension-label";
        clientWidthLabel.style.top = "20%";
        clientWidthLabel.style.left = clientWidth / 2 - 60 + "px";
        clientWidthLabel.textContent = `clientWidth: ${clientWidth}px`;
        dimensionVisualization.appendChild(clientWidthLabel);

        // æº¢å‡ºæŒ‡ç¤ºå™¨
        if (scrollWidth > clientWidth) {
          const overflowLabel = document.createElement("div");
          overflowLabel.className = "dimension-label";
          overflowLabel.style.top = "80%";
          overflowLabel.style.left = clientWidth + (scrollWidth - clientWidth) / 2 - 60 + "px";
          overflowLabel.textContent = `æº¢å‡º: ${scrollWidth - clientWidth}px`;
          overflowLabel.style.background = "rgba(231, 76, 60, 0.9)";
          overflowLabel.style.color = "white";
          dimensionVisualization.appendChild(overflowLabel);
        }
      }

      // æ§åˆ¶å‡½æ•°
      function addNewColumn() {
        columnCount++;
        const newColumn = document.createElement("div");
        newColumn.className = `content-column column-${(columnCount % 5) + 1}`;
        newColumn.innerHTML = `
                <h3>æ–°åˆ— ${columnCount}</h3>
                <p>åŠ¨æ€æ·»åŠ çš„å†…å®¹</p>
                <p>scrollWidth å¢åŠ äº†</p>
                <div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.5); border-radius: 6px;">
                    <p>æ–°åˆ—å®½åº¦: 280px</p>
                    <p>å½±å“ scrollWidth è®¡ç®—</p>
                </div>
            `;
        scrollContent.appendChild(newColumn);
        updateProperties();
      }

      function removeColumn() {
        if (columnCount > 1) {
          const lastColumn = scrollContent.lastElementChild;
          if (lastColumn.classList.contains("content-column")) {
            scrollContent.removeChild(lastColumn);
            columnCount--;
            updateProperties();
          }
        }
      }

      function toggleOverflow() {
        const currentOverflow = scrollElement.style.overflowX;
        if (currentOverflow === "hidden") {
          scrollElement.style.overflowX = "auto";
        } else {
          scrollElement.style.overflowX = "hidden";
        }
        updateProperties();
      }

      function addPseudoElement() {
        if (!hasPseudoElement) {
          const style = document.createElement("style");
          style.textContent = `
                    .scroll-content::before {
                        content: "â† ä¼ªå…ƒç´ å†…å®¹ â†’";
                        display: inline-block;
                        background: rgba(155, 89, 182, 0.3);
                        padding: 10px;
                        margin-right: 20px;
                        border-radius: 4px;
                        border: 1px dashed #9b59b6;
                    }
                `;
          document.head.appendChild(style);
          hasPseudoElement = true;
        }
        updateProperties();
      }

      function toggleHiddenContent() {
        const hiddenContent = scrollContent.querySelector(".hidden-content");
        if (hiddenContent) {
          if (hasHiddenContent) {
            hiddenContent.style.display = "none";
          } else {
            hiddenContent.style.display = "block";
          }
          hasHiddenContent = !hasHiddenContent;
          updateProperties();
        }
      }

      function resetAll() {
        // é‡ç½®å†…å®¹
        scrollContent.innerHTML = `
                <div class="content-column column-1">
                    <h3>ç¬¬ä¸€åˆ—</h3>
                    <p>scrollWidth = å†…å®¹æ€»å®½åº¦</p>
                    <p>åŒ…æ‹¬æ‰€æœ‰å¯è§å’Œä¸å¯è§å†…å®¹</p>
                    <div class="overflow-demo">
                                        <p>è¿™ä¸ªåŒºåŸŸæ¼”ç¤ºäº† scrollWidth çš„è®¡ç®—</p>
                                        <p>å°è¯•è°ƒæ•´å†…å®¹å®½åº¦è§‚å¯Ÿå˜åŒ–</p>
                                    </div>
                                </div>
                                <div class="content-column column-2">
                                    <h3>ç¬¬äºŒåˆ—</h3>
                                    <p>åŒ…å«å†…è¾¹è·</p>
                                    <p>ä¸åŒ…å«è¾¹æ¡†å’Œå¤–è¾¹è·</p>
                                    <div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.5); border-radius: 6px;">
                                        <p>å†…è¾¹è·å½±å“ scrollWidth</p>
                                        <p>ä½†è¾¹æ¡†ä¸å½±å“</p>
                                    </div>
                                </div>
                                <div class="content-column column-3">
                                    <h3>ç¬¬ä¸‰åˆ—</h3>
                                    <p>ä¼ªå…ƒç´ åŒ…å«åœ¨å†…</p>
                                    <p>::before å’Œ ::after</p>
                                    <div style="margin-top: 20px; position: relative;">
                                        <div style="padding: 10px; background: rgba(255,255,255,0.5); border-radius: 4px;">
                                            <p>ä¼ªå…ƒç´ å†…å®¹</p>
                                            <p>ä¹Ÿä¼šè®¡å…¥ scrollWidth</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="content-column column-4">
                                    <h3>ç¬¬å››åˆ—</h3>
                                    <p>éšè—å†…å®¹çš„å½±å“</p>
                                    <p>display: none ä¸åŒ…å«</p>
                                    <div style="margin-top: 20px;">
                                        <div class="hidden-content" style="display: none; padding: 10px; background: rgba(255,255,255,0.5);">
                                            <p>è¿™ä¸ªéšè—å†…å®¹ä¸è®¡å…¥ scrollWidth</p>
                                        </div>
                                        <div class="visible-content" style="padding: 10px; background: rgba(255,255,255,0.5); border-radius: 4px;">
                                            <p>å¯è§å†…å®¹è®¡å…¥ scrollWidth</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="content-column column-5">
                                    <h3>ç¬¬äº”åˆ—</h3>
                                    <p>overflow çš„å½±å“</p>
                                    <p>hidden vs visible</p>
                                    <div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.5); border-radius: 6px;">
                                        <p>overflow ä¸å½±å“ scrollWidth</p>
                                        <p>ä½†å½±å“æ˜¯å¦éœ€è¦æ»šåŠ¨æ¡</p>
                                    </div>
                                </div>
                            `;

        // é‡ç½®æ§åˆ¶
        columnCount = 5;
        hasPseudoElement = false;
        hasHiddenContent = false;
        scrollElement.style.overflowX = "auto";

        // ç§»é™¤ä¼ªå…ƒç´ æ ·å¼
        document.querySelectorAll("style").forEach(style => {
          if (style.textContent.includes(".scroll-content::before")) {
            style.remove();
          }
        });

        // é‡ç½®æ»‘å—
        contentWidthSlider.value = 1200;
        paddingSlider.value = 20;
        marginSlider.value = 15;
        contentWidthValue.textContent = "1200px";
        paddingValue.textContent = "20px";
        marginValue.textContent = "15px";

        updateProperties();
      }

      // äº‹ä»¶ç›‘å¬
      contentWidthSlider.addEventListener("input", function () {
        const width = parseInt(this.value);
        scrollContent.style.minWidth = width + "px";
        contentWidthValue.textContent = width + "px";
        updateProperties();
      });

      paddingSlider.addEventListener("input", function () {
        const padding = parseInt(this.value);
        scrollContent.style.padding = padding + "px";
        paddingValue.textContent = padding + "px";
        updateProperties();
      });

      marginSlider.addEventListener("input", function () {
        const margin = parseInt(this.value);
        const columns = scrollContent.querySelectorAll(".content-column");
        columns.forEach(column => {
          column.style.margin = `0 ${margin}px`;
        });
        marginValue.textContent = margin + "px";
        updateProperties();
      });

      // ç›‘å¬çª—å£å¤§å°å˜åŒ–
      window.addEventListener("resize", updateProperties);

      // åˆå§‹åŒ–
      updateProperties();

      // æ§åˆ¶å°æ¼”ç¤º
      setTimeout(() => {
        console.log("=== scrollWidth å±æ€§æ¼”ç¤º ===");
        console.log("åˆå§‹ scrollWidth:", scrollElement.scrollWidth);
        console.log("clientWidth:", scrollElement.clientWidth);
        console.log("offsetWidth:", scrollElement.offsetWidth);
        console.log("æ˜¯å¦éœ€è¦æ°´å¹³æ»šåŠ¨:", scrollElement.scrollWidth > scrollElement.clientWidth);

        // æ¼”ç¤ºå†…å®¹è®¡ç®—
        console.log("\nğŸ”¢ å†…å®¹å®½åº¦è®¡ç®—:");
        const columns = scrollContent.querySelectorAll(".content-column");
        let totalContentWidth = 0;
        columns.forEach(column => {
          totalContentWidth += column.offsetWidth;
        });
        const computedStyle = getComputedStyle(scrollContent);
        const paddingLeft = parseInt(computedStyle.paddingLeft);
        const paddingRight = parseInt(computedStyle.paddingRight);

        console.log("åˆ—æ€»å®½åº¦:", totalContentWidth);
        console.log("å†…è¾¹è·:", paddingLeft + paddingRight);
        console.log("è®¡ç®—æ€»å®½åº¦:", totalContentWidth + paddingLeft + paddingRight);
        console.log("å®é™… scrollWidth:", scrollElement.scrollWidth);

        // æ£€æµ‹ä¼ªå…ƒç´ å½±å“
        console.log("\nğŸ‘» ä¼ªå…ƒç´ å½±å“:");
        const beforePseudo = getComputedStyle(scrollContent, "::before");
        console.log("ä¼ªå…ƒç´ å†…å®¹:", beforePseudo.content);
        console.log("ä¼ªå…ƒç´ å®½åº¦:", beforePseudo.width);
      }, 1000);
    </script>
  </body>
</html>
