<!DOCTYPE html>
<html>
<head>
    <title>拖拽功能实现</title>
    <style>
        .container {
            width: 600px;
            height: 400px;
            border: 2px dashed #bdc3c7;
            position: relative;
            margin: 20px auto;
            background: #ecf0f1;
        }
        .draggable {
            width: 100px;
            height: 100px;
            background: #3498db;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: move;
            position: absolute;
            user-select: none;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        .drop-zone {
            width: 150px;
            height: 150px;
            border: 3px solid #2ecc71;
            position: absolute;
            top: 50px;
            right: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(46, 204, 113, 0.1);
        }
        .info {
            text-align: center;
            margin: 20px;
        }
    </style>
</head>
<body>
    <div class="info">
        <h2>拖拽演示</h2>
        <p>拖拽蓝色方块到绿色区域</p>
        <div id="status">准备拖拽...</div>
    </div>
    
    <div class="container" id="container">
        <div class="draggable" id="draggable">拖拽我</div>
        <div class="drop-zone" id="dropZone">放置区域</div>
    </div>

    <script>
        class DragManager {
            constructor() {
                this.draggable = document.getElementById('draggable');
                this.dropZone = document.getElementById('dropZone');
                this.status = document.getElementById('status');
                this.isDragging = false;
                this.offset = { x: 0, y: 0 };
                
                this.init();
            }
            
            init() {
                this.draggable.addEventListener('mousedown', this.startDrag.bind(this));
                document.addEventListener('mousemove', this.drag.bind(this));
                document.addEventListener('mouseup', this.stopDrag.bind(this));
                
                // 触摸设备支持
                this.draggable.addEventListener('touchstart', this.startDrag.bind(this));
                document.addEventListener('touchmove', this.drag.bind(this));
                document.addEventListener('touchend', this.stopDrag.bind(this));
            }
            
            startDrag(e) {
                e.preventDefault();
                this.isDragging = true;
                
                const clientX = e.clientX || e.touches[0].clientX;
                const clientY = e.clientY || e.touches[0].clientY;
                const rect = this.draggable.getBoundingClientRect();
                
                // 计算鼠标/触摸点相对于元素左上角的偏移
                this.offset.x = clientX - rect.left;
                this.offset.y = clientY - rect.top;
                
                this.draggable.style.cursor = 'grabbing';
                this.status.textContent = '拖拽中...';
            }
            
            drag(e) {
                if (!this.isDragging) return;
                e.preventDefault();
                
                const clientX = e.clientX || e.touches[0].clientX;
                const clientY = e.clientY || e.touches[0].clientY;
                const container = document.getElementById('container');
                const containerRect = container.getBoundingClientRect();
                
                // 计算新位置（限制在容器内）
                let newX = clientX - containerRect.left - this.offset.x;
                let newY = clientY - containerRect.top - this.offset.y;
                
                // 边界检查
                newX = Math.max(0, Math.min(newX, containerRect.width - this.draggable.offsetWidth));
                newY = Math.max(0, Math.min(newY, containerRect.height - this.draggable.offsetHeight));
                
                // 应用新位置
                this.draggable.style.left = newX + 'px';
                this.draggable.style.top = newY + 'px';
                
                // 检查是否在放置区域内
                this.checkDropZone();
            }
            
            stopDrag() {
                if (!this.isDragging) return;
                
                this.isDragging = false;
                this.draggable.style.cursor = 'move';
                
                const draggableRect = this.draggable.getBoundingClientRect();
                const dropZoneRect = this.dropZone.getBoundingClientRect();
                
                // 检查最终位置是否在放置区域内
                if (this.isOverlapping(draggableRect, dropZoneRect)) {
                    this.status.textContent = '✅ 成功放置在目标区域！';
                    this.draggable.style.background = '#2ecc71';
                } else {
                    this.status.textContent = '准备拖拽...';
                    this.draggable.style.background = '#3498db';
                }
            }
            
            checkDropZone() {
                const draggableRect = this.draggable.getBoundingClientRect();
                const dropZoneRect = this.dropZone.getBoundingClientRect();
                
                if (this.isOverlapping(draggableRect, dropZoneRect)) {
                    this.dropZone.style.background = 'rgba(46, 204, 113, 0.3)';
                    this.dropZone.style.borderColor = '#27ae60';
                } else {
                    this.dropZone.style.background = 'rgba(46, 204, 113, 0.1)';
                    this.dropZone.style.borderColor = '#2ecc71';
                }
            }
            
            isOverlapping(rect1, rect2) {
                return !(
                    rect1.right < rect2.left ||
                    rect1.left > rect2.right ||
                    rect1.bottom < rect2.top ||
                    rect1.top > rect2.bottom
                );
            }
        }

        // 初始化拖拽管理器
        new DragManager();
    </script>
</body>
</html>