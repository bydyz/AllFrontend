<!DOCTYPE html>
<html>
  <head>
    <title>æ–‡ä»¶ä¸Šä¼ æ§åˆ¶</title>
    <style>
      .upload-area {
        border: 2px dashed #007bff;
        border-radius: 10px;
        padding: 40px;
        text-align: center;
        margin: 20px 0;
        transition: all 0.3s ease;
      }
      .upload-area.dragover {
        background: #e3f2fd;
        border-color: #0056b3;
      }
      .file-list {
        margin: 20px 0;
      }
      .file-item {
        padding: 10px;
        margin: 5px 0;
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 5px;
      }
      .file-item.error {
        background: #f8d7da;
        border-color: #f5c6cb;
      }
      .file-item.success {
        background: #d1edff;
        border-color: #b8daff;
      }
      .progress {
        height: 5px;
        background: #e9ecef;
        margin: 5px 0;
        border-radius: 3px;
        overflow: hidden;
      }
      .progress-bar {
        height: 100%;
        background: #007bff;
        width: 0%;
        transition: width 0.3s ease;
      }
    </style>
  </head>
  <body>
    <h2>æ–‡ä»¶ä¸Šä¼ æ§åˆ¶æ¼”ç¤º</h2>

    <div class="upload-area" id="uploadArea">
      <p>ğŸ“ æ‹–æ”¾æ–‡ä»¶åˆ°è¿™é‡Œ æˆ– <input type="file" id="fileInput" multiple /></p>
      <p class="hint">æ”¯æŒå¤šä¸ªæ–‡ä»¶ï¼Œæœ€å¤§ 10MBï¼Œä»…é™å›¾ç‰‡å’Œæ–‡æ¡£</p>
    </div>

    <div class="file-list" id="fileList"></div>

    <script>
      class FileUploadController {
        constructor() {
          this.uploadArea = document.getElementById("uploadArea");
          this.fileInput = document.getElementById("fileInput");
          this.fileList = document.getElementById("fileList");
          this.maxSize = 10 * 1024 * 1024; // 10MB
          this.allowedTypes = ["image/jpeg", "image/png", "image/gif", "application/pdf", "text/plain"];

          this.setupEventListeners();
        }

        setupEventListeners() {
          // æ–‡ä»¶è¾“å…¥å˜åŒ–
          this.fileInput.addEventListener("change", event => {
            this.handleFiles(event.target.files);
          });

          // æ‹–æ”¾äº‹ä»¶
          this.uploadArea.addEventListener("dragover", event => {
            event.preventDefault(); // å¿…é¡»é˜»æ­¢é»˜è®¤è¡Œä¸ºæ‰èƒ½æˆä¸ºæœ‰æ•ˆçš„æ”¾ç½®ç›®æ ‡
            this.uploadArea.classList.add("dragover");
            event.dataTransfer.dropEffect = "copy";
          });

          this.uploadArea.addEventListener("dragleave", event => {
            this.uploadArea.classList.remove("dragover");
          });

          this.uploadArea.addEventListener("drop", event => {
            event.preventDefault(); // é˜»æ­¢æµè§ˆå™¨é»˜è®¤çš„æ‰“å¼€æ–‡ä»¶è¡Œä¸º
            this.uploadArea.classList.remove("dragover");

            const files = event.dataTransfer.files;
            this.handleFiles(files);
          });

          // é˜»æ­¢æ–‡æ¡£å…¶ä»–åŒºåŸŸçš„é»˜è®¤æ‹–æ”¾è¡Œä¸º
          document.addEventListener("dragover", event => {
            if (!event.target.closest("#uploadArea")) {
              event.preventDefault();
            }
          });

          document.addEventListener("drop", event => {
            if (!event.target.closest("#uploadArea")) {
              event.preventDefault();
            }
          });
        }

        handleFiles(files) {
          for (let file of files) {
            if (this.validateFile(file)) {
              this.addFileToList(file);
              this.simulateUpload(file);
            }
          }
        }

        validateFile(file) {
          // æ£€æŸ¥æ–‡ä»¶ç±»å‹
          if (!this.allowedTypes.includes(file.type)) {
            this.showError(`ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹: ${file.type}`);
            return false;
          }

          // æ£€æŸ¥æ–‡ä»¶å¤§å°
          if (file.size > this.maxSize) {
            this.showError(`æ–‡ä»¶å¤ªå¤§: ${(file.size / 1024 / 1024).toFixed(2)}MB (æœ€å¤§10MB)`);
            return false;
          }

          return true;
        }

        addFileToList(file) {
          const fileItem = document.createElement("div");
          fileItem.className = "file-item";
          fileItem.innerHTML = `
                    <div><strong>${file.name}</strong> (${(file.size / 1024).toFixed(2)}KB)</div>
                    <div class="progress">
                        <div class="progress-bar" id="progress-${file.name}"></div>
                    </div>
                    <div class="status">å‡†å¤‡ä¸Šä¼ ...</div>
                `;

          this.fileList.appendChild(fileItem);
          return fileItem;
        }

        simulateUpload(file) {
          const progressBar = document.getElementById(`progress-${file.name}`);
          const statusDiv = progressBar.parentElement.nextElementSibling;

          let progress = 0;
          const interval = setInterval(() => {
            progress += Math.random() * 10;
            if (progress >= 100) {
              progress = 100;
              clearInterval(interval);

              progressBar.style.background = "#28a745";
              statusDiv.textContent = "âœ… ä¸Šä¼ å®Œæˆ";
              statusDiv.parentElement.classList.add("success");

              this.onUploadComplete(file);
            } else {
              progressBar.style.width = `${progress}%`;
              statusDiv.textContent = `ä¸Šä¼ ä¸­... ${Math.round(progress)}%`;
            }
          }, 200);
        }

        onUploadComplete(file) {
          console.log(`æ–‡ä»¶ä¸Šä¼ å®Œæˆ: ${file.name}`);
          // è¿™é‡Œå¯ä»¥æ‰§è¡Œå®é™…çš„ä¸Šä¼ é€»è¾‘
        }

        showError(message) {
          const errorItem = document.createElement("div");
          errorItem.className = "file-item error";
          errorItem.textContent = `âŒ ${message}`;
          this.fileList.appendChild(errorItem);

          console.error(message);
        }
      }

      // åˆå§‹åŒ–æ–‡ä»¶ä¸Šä¼ æ§åˆ¶å™¨
      const uploadController = new FileUploadController();

      // æ·»åŠ ä¸€äº›é¢å¤–çš„å®‰å…¨æ§åˆ¶
      document.addEventListener("contextmenu", event => {
        // åœ¨æ–‡ä»¶ä¸Šä¼ åŒºåŸŸç¦ç”¨å³é”®èœå•
        if (event.target.closest("#uploadArea")) {
          event.preventDefault();
        }
      });

      // é˜²æ­¢æ–‡ä»¶è¢«æ‹–å‡ºæµè§ˆå™¨
      document.addEventListener("dragstart", event => {
        if (event.target.tagName === "IMG") {
          event.preventDefault();
        }
      });
    </script>
  </body>
</html>
