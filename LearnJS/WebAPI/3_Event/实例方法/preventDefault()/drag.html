<!DOCTYPE html>
<html>
  <head>
    <title>拖放控制示例</title>
    <style>
      .drag-container {
        display: flex;
        gap: 20px;
        margin: 20px 0;
      }
      .drag-area {
        width: 200px;
        height: 150px;
        border: 2px dashed #ccc;
        padding: 20px;
        text-align: center;
      }
      .drag-item {
        padding: 10px;
        margin: 5px;
        background: #f0f0f0;
        border: 1px solid #ddd;
        cursor: move;
      }
      .drop-area {
        background: #e8f5e8;
        border-color: #4caf50;
      }
      .dragging {
        opacity: 0.5;
        background: #d0e0ff;
      }
    </style>
  </head>
  <body>
    <h2>拖放操作控制</h2>

    <div class="drag-container">
      <div class="drag-area" id="sourceArea">
        <h3>源区域</h3>
        <div class="drag-item" draggable="true">可拖动项目 1</div>
        <div class="drag-item" draggable="true">可拖动项目 2</div>
        <div class="drag-item" draggable="true">可拖动项目 3</div>
      </div>

      <div class="drag-area drop-area" id="dropArea">
        <h3>放置区域</h3>
        <p>拖拽项目到这里</p>
      </div>
    </div>

    <div id="dragLog" style="margin: 20px; padding: 10px; border: 1px solid #ccc"></div>

    <script>
      const sourceArea = document.getElementById("sourceArea");
      const dropArea = document.getElementById("dropArea");
      const dragLog = document.getElementById("dragLog");

      function log(message) {
        dragLog.innerHTML += `<div>${new Date().toLocaleTimeString()}: ${message}</div>`;
        dragLog.scrollTop = dragLog.scrollHeight;
      }

      // 为所有可拖动元素添加事件监听
      document.querySelectorAll(".drag-item").forEach(item => {
        // 拖动开始
        item.addEventListener("dragstart", function (event) {
          event.dataTransfer.setData("text/plain", this.textContent);
          this.classList.add("dragging");
          log(`开始拖动: ${this.textContent}`);
        });

        // 拖动结束
        item.addEventListener("dragend", function (event) {
          this.classList.remove("dragging");
          log(`结束拖动: ${this.textContent}`);
        });

        // 阻止默认的拖动行为（如图片拖动）
        item.addEventListener("mousedown", function (event) {
          // 防止文本选择
          if (event.button === 0) {
            // 左键
            event.preventDefault();
          }
        });
      });

      // 放置区域事件
      dropArea.addEventListener("dragover", function (event) {
        event.preventDefault(); // 必须阻止默认行为才能成为有效的放置目标
        event.dataTransfer.dropEffect = "move";
        this.style.background = "#d4edda";
      });

      dropArea.addEventListener("dragleave", function (event) {
        this.style.background = "#e8f5e8";
      });

      dropArea.addEventListener("drop", function (event) {
        event.preventDefault(); // 阻止浏览器默认的打开文件行为

        const data = event.dataTransfer.getData("text/plain");
        log(`成功放置: ${data}`);

        // 创建新的项目
        const newItem = document.createElement("div");
        newItem.className = "drag-item";
        newItem.textContent = `已放置: ${data}`;
        newItem.draggable = false; // 放置后不可再拖动

        this.appendChild(newItem);
        this.style.background = "#e8f5e8";
      });

      // 阻止整个文档的默认拖放行为
      document.addEventListener("dragover", function (event) {
        // 如果不是在放置区域上方，阻止默认行为
        if (!event.target.closest(".drop-area")) {
          event.preventDefault();
        }
      });

      document.addEventListener("drop", function (event) {
        // 如果不是在放置区域，阻止默认行为
        if (!event.target.closest(".drop-area")) {
          event.preventDefault();
          log("在无效区域放置，已阻止默认行为");
        }
      });

      log("拖放系统已初始化");
    </script>
  </body>
</html>
