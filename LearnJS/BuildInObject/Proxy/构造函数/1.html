<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JavaScript Proxy 构造函数详解</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        color: #333;
        background: linear-gradient(135deg, #f5f7fa 0%, #e4efe9 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      header {
        text-align: center;
        margin-bottom: 40px;
      }

      h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
        color: #2c3e50;
      }

      .description {
        font-size: 1.2rem;
        color: #7f8c8d;
        max-width: 800px;
        margin: 0 auto;
      }

      section {
        background-color: white;
        padding: 25px;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
      }

      h2 {
        color: #2c3e50;
        margin-bottom: 20px;
        border-bottom: 2px solid #eee;
        padding-bottom: 10px;
      }

      h3 {
        color: #3498db;
        margin: 20px 0 15px;
      }

      p {
        margin-bottom: 15px;
      }

      .code-example {
        background-color: #2d3436;
        color: #f5f7fa;
        padding: 15px;
        border-radius: 5px;
        font-family: "Fira Code", monospace;
        margin: 15px 0;
        overflow-x: auto;
      }

      .js-keyword {
        color: #74b9ff;
      }

      .js-function {
        color: #55efc4;
      }

      .js-number {
        color: #ffeaa7;
      }

      .js-string {
        color: #fd79a8;
      }

      .js-comment {
        color: #a29bfe;
      }

      .note {
        background-color: #e3f2fd;
        border-left: 4px solid #2196f3;
        padding: 15px;
        margin: 15px 0;
        border-radius: 0 5px 5px 0;
      }

      .demo-area {
        background-color: #f8f9fa;
        padding: 20px;
        border-radius: 5px;
        margin: 20px 0;
        border: 1px solid #e9ecef;
      }

      .demo-result {
        background-color: #2d3436;
        color: #f5f7fa;
        padding: 15px;
        border-radius: 5px;
        margin: 15px 0;
        font-family: "Fira Code", monospace;
      }

      .handler-methods {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
        margin: 20px 0;
      }

      .handler-item {
        background-color: #f8f9fa;
        padding: 15px;
        border-radius: 5px;
        border: 1px solid #e9ecef;
      }

      .handler-title {
        font-weight: bold;
        color: #2c3e50;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
      }

      .handler-icon {
        margin-right: 10px;
        color: #3498db;
      }

      .interactive-demo {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin: 20px 0;
      }

      .input-group {
        margin-bottom: 15px;
      }

      .input-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
      }

      .input-group input,
      .input-group select {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-family: "Fira Code", monospace;
      }

      .btn {
        padding: 10px 20px;
        background-color: #3498db;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 1rem;
        transition: background-color 0.3s ease;
      }

      .btn:hover {
        background-color: #2980b9;
      }

      .output-area {
        background-color: #2d3436;
        color: #f5f7fa;
        padding: 15px;
        border-radius: 5px;
        font-family: "Fira Code", monospace;
        min-height: 200px;
        overflow-y: auto;
      }

      .proxy-visualization {
        display: flex;
        flex-direction: column;
        gap: 15px;
        margin: 20px 0;
      }

      .proxy-step {
        display: flex;
        align-items: center;
        padding: 15px;
        background-color: #f8f9fa;
        border-radius: 5px;
        border: 1px solid #e9ecef;
      }

      .step-number {
        background-color: #3498db;
        color: white;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 15px;
        font-weight: bold;
      }

      .step-description {
        flex: 1;
      }

      @media (max-width: 768px) {
        .handler-methods,
        .interactive-demo {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>JavaScript Proxy 构造函数详解</h1>
        <p class="description">探索JavaScript中Proxy构造函数的概念、用法和实际应用</p>
      </header>

      <section>
        <h2>Proxy 概述</h2>
        <p>Proxy 对象用于创建一个对象的代理，从而可以拦截和自定义对象的底层操作。</p>

        <div class="note">
          <p><strong>Proxy 语法：</strong>new Proxy(target, handler)</p>
          <ul style="margin-left: 20px;">
            <li><code>target</code>：要代理的目标对象</li>
            <li><code>handler</code>：一个对象，其属性是定义代理行为的函数</li>
          </ul>
        </div>

        <div class="code-example">
          <span class="js-comment">// 基本 Proxy 示例</span><br />
          <span class="js-keyword">const</span> target = {<br />
          &nbsp;&nbsp;<span class="js-keyword">message</span>: <span class="js-string">"Hello, World!"</span><br />
          };<br />
          <br />
          <span class="js-keyword">const</span> handler = {<br />
          &nbsp;&nbsp;<span class="js-function">get</span>(target, prop, receiver) {<br />
          &nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">if</span> (prop === <span class="js-string">'message'</span>) {<br />
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">return</span> target[prop].<span class="js-function">toUpperCase</span>();<br />
          &nbsp;&nbsp;&nbsp;&nbsp;}<br />
          &nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">return</span> <span class="js-function">Reflect</span>.<span class="js-function">get</span>(...arguments);<br />
          &nbsp;&nbsp;}<br />
          };<br />
          <br />
          <span class="js-keyword">const</span> proxy = <span class="js-keyword">new</span> <span class="js-function">Proxy</span>(target, handler);<br />
          <span class="js-function">console.log</span>(proxy.message); <span class="js-comment">// "HELLO, WORLD!"</span>
        </div>

        <div class="demo-result" id="basic-proxy">
          <!-- 将由JavaScript填充 -->
        </div>
      </section>

      <section>
        <h2>Proxy 工作原理</h2>

        <div class="proxy-visualization">
          <div class="proxy-step">
            <div class="step-number">1</div>
            <div class="step-description">创建目标对象和处理器对象</div>
          </div>

          <div class="proxy-step">
            <div class="step-number">2</div>
            <div class="step-description">使用 <code>new Proxy(target, handler)</code> 创建代理</div>
          </div>

          <div class="proxy-step">
            <div class="step-number">3</div>
            <div class="step-description">通过代理对象访问目标对象的属性或方法</div>
          </div>

          <div class="proxy-step">
            <div class="step-number">4</div>
            <div class="step-description">代理拦截操作并调用处理器中对应的陷阱函数</div>
          </div>

          <div class="proxy-step">
            <div class="step-number">5</div>
            <div class="step-description">陷阱函数可以自定义行为，也可以将操作转发给目标对象</div>
          </div>
        </div>

        <div class="demo-area">
          <h3>Proxy 工作流程示例</h3>
          <div class="code-example">
            <span class="js-keyword">const</span> target = { <span class="js-keyword">name</span>: <span class="js-string">"Alice"</span>, <span class="js-keyword">age</span>: <span class="js-number">30</span> };<br />
            <br />
            <span class="js-keyword">const</span> handler = {<br />
            &nbsp;&nbsp;<span class="js-comment">// 拦截属性读取操作</span><br />
            &nbsp;&nbsp;<span class="js-function">get</span>(target, property) {<br />
            &nbsp;&nbsp;&nbsp;&nbsp;<span class="js-function">console.log</span>(<span class="js-string">`读取属性: <span class="js-keyword">${</span>property<span class="js-keyword">}</span>`</span>);<br />
            &nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">return</span> target[property];<br />
            &nbsp;&nbsp;},<br />
            <br />
            &nbsp;&nbsp;<span class="js-comment">// 拦截属性设置操作</span><br />
            &nbsp;&nbsp;<span class="js-function">set</span>(target, property, value) {<br />
            &nbsp;&nbsp;&nbsp;&nbsp;<span class="js-function">console.log</span>(<span class="js-string">`设置属性: <span class="js-keyword">${</span>property<span class="js-keyword">}</span> = <span class="js-keyword">${</span>value<span class="js-keyword">}</span>`</span>);<br />
            &nbsp;&nbsp;&nbsp;&nbsp;target[property] = value;<br />
            &nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">return</span> <span class="js-keyword">true</span>; <span class="js-comment">// 表示设置成功</span><br />
            &nbsp;&nbsp;}<br />
            };<br />
            <br />
            <span class="js-keyword">const</span> proxy = <span class="js-keyword">new</span> <span class="js-function">Proxy</span>(target, handler);<br />
            <br />
            <span class="js-comment">// 通过代理访问属性</span><br />
            <span class="js-function">console.log</span>(proxy.name); <span class="js-comment">// 触发get陷阱</span><br />
            proxy.age = <span class="js-number">31</span>; <span class="js-comment">// 触发set陷阱</span>
          </div>

          <div class="demo-result" id="proxy-workflow">
            <!-- 将由JavaScript填充 -->
          </div>
        </div>
      </section>

      <section>
        <h2>常用的处理器方法</h2>

        <div class="handler-methods">
          <div class="handler-item">
            <div class="handler-title">
              <span class="handler-icon">📝</span>
              <span>get(target, prop, receiver)</span>
            </div>
            <p>拦截对象属性的读取操作。</p>
            <div class="code-example">
              <span class="js-function">get</span>(target, prop) {<br />
              &nbsp;&nbsp;<span class="js-keyword">return</span> target[prop] || <span class="js-string">'默认值'</span>;<br />
              }
            </div>
          </div>

          <div class="handler-item">
            <div class="handler-title">
              <span class="handler-icon">✏️</span>
              <span>set(target, prop, value, receiver)</span>
            </div>
            <p>拦截对象属性的设置操作。</p>
            <div class="code-example">
              <span class="js-function">set</span>(target, prop, value) {<br />
              &nbsp;&nbsp;<span class="js-keyword">if</span> (prop === <span class="js-string">'age'</span> && value < <span class="js-number">0</span>) {<br />
              &nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">throw</span> <span class="js-keyword">new</span> <span class="js-function">Error</span>(<span class="js-string">'年龄不能为负数'</span>);<br />
              &nbsp;&nbsp;}<br />
              &nbsp;&nbsp;target[prop] = value;<br />
              &nbsp;&nbsp;<span class="js-keyword">return</span> <span class="js-keyword">true</span>;<br />
              }
            </div>
          </div>

          <div class="handler-item">
            <div class="handler-title">
              <span class="handler-icon">🔍</span>
              <span>has(target, prop)</span>
            </div>
            <p>拦截 <code>in</code> 操作符的行为。</p>
            <div class="code-example">
              <span class="js-function">has</span>(target, prop) {<br />
              &nbsp;&nbsp;<span class="js-keyword">if</span> (prop.<span class="js-function">startsWith</span>(<span class="js-string">'_'</span>)) {<br />
              &nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">return</span> <span class="js-keyword">false</span>; <span class="js-comment">// 隐藏私有属性</span><br />
              &nbsp;&nbsp;}<br />
              &nbsp;&nbsp;<span class="js-keyword">return</span> prop <span class="js-keyword">in</span> target;<br />
              }
            </div>
          </div>

          <div class="handler-item">
            <div class="handler-title">
              <span class="handler-icon">🗑️</span>
              <span>deleteProperty(target, prop)</span>
            </div>
            <p>拦截 <code>delete</code> 操作符的行为。</p>
            <div class="code-example">
              <span class="js-function">deleteProperty</span>(target, prop) {<br />
              &nbsp;&nbsp;<span class="js-keyword">if</span> (prop === <span class="js-string">'id'</span>) {<br />
              &nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">throw</span> <span class="js-keyword">new</span> <span class="js-function">Error</span>(<span class="js-string">'不能删除id属性'</span>);<br />
              &nbsp;&nbsp;}<br />
              &nbsp;&nbsp;<span class="js-keyword">return</span> <span class="js-keyword">true</span>;<br />
              }
            </div>
          </div>

          <div class="handler-item">
            <div class="handler-title">
              <span class="handler-icon">📋</span>
              <span>ownKeys(target)</span>
            </div>
            <p>拦截 <code>Object.getOwnPropertyNames()</code> 和类似操作。</p>
            <div class="code-example">
              <span class="js-function">ownKeys</span>(target) {<br />
              &nbsp;&nbsp;<span class="js-keyword">return</span> <span class="js-function">Object</span>.<span class="js-function">getOwnPropertyNames</span>(target)<br />
              &nbsp;&nbsp;&nbsp;&nbsp;.<span class="js-function">filter</span>(key => !key.<span class="js-function">startsWith</span>(<span class="js-string">'_'</span>));<br />
              }
            </div>
          </div>

          <div class="handler-item">
            <div class="handler-title">
              <span class="handler-icon">🔄</span>
              <span>apply(target, thisArg, argumentsList)</span>
            </div>
            <p>拦截函数的调用操作。</p>
            <div class="code-example">
              <span class="js-function">apply</span>(target, thisArg, argumentsList) {<br />
              &nbsp;&nbsp;<span class="js-function">console.log</span>(<span class="js-string">`函数被调用，参数: <span class="js-keyword">${</span>argumentsList<span class="js-keyword">}</span>`</span>);<br />
              &nbsp;&nbsp;<span class="js-keyword">return</span> target.<span class="js-function">apply</span>(thisArg, argumentsList);<br />
              }
            </div>
          </div>
        </div>
      </section>

      <section>
        <h2>Proxy 实际应用示例</h2>

        <div class="demo-area">
          <h3>1. 数据验证</h3>
          <div class="code-example">
            <span class="js-keyword">function</span> <span class="js-function">createValidatedObject</span>() {<br />
            &nbsp;&nbsp;<span class="js-keyword">const</span> target = {};<br />
            &nbsp;&nbsp;<span class="js-keyword">const</span> handler = {<br />
            &nbsp;&nbsp;&nbsp;&nbsp;<span class="js-function">set</span>(target, prop, value) {<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">if</span> (prop === <span class="js-string">'age'</span>) {<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">if</span> (<span class="js-keyword">typeof</span> value !== <span class="js-string">'number'</span> || value < <span class="js-number">0</span> || value > <span class="js-number">150</span>) {<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">throw</span> <span class="js-keyword">new</span> <span class="js-function">Error</span>(<span class="js-string">'年龄必须是0到150之间的数字'</span>);<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">if</span> (prop === <span class="js-string">'email'</span>) {<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">const</span> emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">if</span> (!emailRegex.<span class="js-function">test</span>(value)) {<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">throw</span> <span class="js-keyword">new</span> <span class="js-function">Error</span>(<span class="js-string">'邮箱格式不正确'</span>);<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;target[prop] = value;<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">return</span> <span class="js-keyword">true</span>;<br />
            &nbsp;&nbsp;&nbsp;&nbsp;}<br />
            &nbsp;&nbsp;};<br />
            &nbsp;&nbsp;<span class="js-keyword">return</span> <span class="js-keyword">new</span> <span class="js-function">Proxy</span>(target, handler);<br />
            }<br />
            <br />
            <span class="js-keyword">const</span> user = <span class="js-function">createValidatedObject</span>();<br />
            user.age = <span class="js-number">25</span>; <span class="js-comment">// 成功</span><br />
            <span class="js-comment">// user.age = -5; // 抛出错误</span><br />
            user.email = <span class="js-string">"test@example.com"</span>; <span class="js-comment">// 成功</span><br />
            <span class="js-comment">// user.email = "invalid" // 抛出错误</span>
          </div>

          <div class="demo-result" id="validation-example">
            <!-- 将由JavaScript填充 -->
          </div>
        </div>

        <div class="demo-area">
          <h3>2. 日志记录</h3>
          <div class="code-example">
            <span class="js-keyword">function</span> <span class="js-function">createLoggableObject</span>() {<br />
            &nbsp;&nbsp;<span class="js-keyword">const</span> target = {};<br />
            &nbsp;&nbsp;<span class="js-keyword">const</span> handler = {<br />
            &nbsp;&nbsp;&nbsp;&nbsp;<span class="js-function">get</span>(target, prop) {<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js-function">console.log</span>(<span class="js-string">`读取属性 '<span class="js-keyword">${</span>prop<span class="js-keyword">}</span>'`</span>);<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">return</span> target[prop];<br />
            &nbsp;&nbsp;&nbsp;&nbsp;},<br />
            &nbsp;&nbsp;&nbsp;&nbsp;<span class="js-function">set</span>(target, prop, value) {<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js-function">console.log</span>(<span class="js-string">`设置属性 '<span class="js-keyword">${</span>prop<span class="js-keyword">}</span>' = '<span class="js-keyword">${</span>value<span class="js-keyword">}</span>'`</span>);<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;target[prop] = value;<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">return</span> <span class="js-keyword">true</span>;<br />
            &nbsp;&nbsp;&nbsp;&nbsp;}<br />
            &nbsp;&nbsp;};<br />
            &nbsp;&nbsp;<span class="js-keyword">return</span> <span class="js-keyword">new</span> <span class="js-function">Proxy</span>(target, handler);<br />
            }<br />
            <br />
            <span class="js-keyword">const</span> obj = <span class="js-function">createLoggableObject</span>();<br />
            obj.name = <span class="js-string">"Alice"</span>; <span class="js-comment">// 日志: 设置属性 'name' = 'Alice'</span><br />
            <span class="js-keyword">const</span> name = obj.name; <span class="js-comment">// 日志: 读取属性 'name'</span>
          </div>

          <div class="demo-result" id="logging-example">
            <!-- 将由JavaScript填充 -->
          </div>
        </div>

        <div class="demo-area">
          <h3>3. 数组负索引支持</h3>
          <div class="code-example">
            <span class="js-keyword">function</span> <span class="js-function">createNegativeIndexArray</span>(...elements) {<br />
            &nbsp;&nbsp;<span class="js-keyword">const</span> array = [...elements];<br />
            &nbsp;&nbsp;<span class="js-keyword">const</span> handler = {<br />
            &nbsp;&nbsp;&nbsp;&nbsp;<span class="js-function">get</span>(target, prop) {<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">let</span> index = <span class="js-function">Number</span>(prop);<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js-comment">// 如果是负索引，从末尾开始计算</span><br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">if</span> (index < <span class="js-number">0</span>) {<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index = target.length + index;<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">return</span> target[index];<br />
            &nbsp;&nbsp;&nbsp;&nbsp;}<br />
            &nbsp;&nbsp;};<br />
            &nbsp;&nbsp;<span class="js-keyword">return</span> <span class="js-keyword">new</span> <span class="js-function">Proxy</span>(array, handler);<br />
            }<br />
            <br />
            <span class="js-keyword">const</span> arr = <span class="js-function">createNegativeIndexArray</span>(<span class="js-string">'a'</span>, <span class="js-string">'b'</span>, <span class="js-string">'c'</span>, <span class="js-string">'d'</span>);<br />
            <span class="js-function">console.log</span>(arr[-<span class="js-number">1</span>]); <span class="js-comment">// 'd'（最后一个元素）</span><br />
            <span class="js-function">console.log</span>(arr[-<span class="js-number">2</span>]); <span class="js-comment">// 'c'（倒数第二个元素）</span>
          </div>

          <div class="demo-result" id="negative-index-example">
            <!-- 将由JavaScript填充 -->
          </div>
        </div>
      </section>

      <section>
        <h2>交互式 Proxy 演示</h2>

        <div class="interactive-demo">
          <div>
            <h3>创建代理对象</h3>
            <div class="input-group">
              <label for="property-name">属性名:</label>
              <input type="text" id="property-name" value="message" />
            </div>

            <div class="input-group">
              <label for="property-value">属性值:</label>
              <input type="text" id="property-value" value="Hello, Proxy!" />
            </div>

            <div class="input-group" style="display: flex; justify-content: start; align-items: center;">
              <label for="enable-validation" style="margin-bottom: 0; margin-right: 8px;">启用验证</label>
              <input type="checkbox" id="enable-validation" style="width: 16px; height: 16px;" />
            </div>

            <div class="input-group" style="display: flex; justify-content: start; align-items: center;">
              <label for="enable-logging" style="margin-bottom: 0; margin-right: 8px;">启用日志</label>
              <input type="checkbox" id="enable-logging" style="width: 16px; height: 16px;" />
            </div>

            <button class="btn" id="create-proxy">创建代理</button>
            <button class="btn" id="get-property">读取属性</button>
            <button class="btn" id="set-property">设置属性</button>
          </div>

          <div>
            <h3>操作结果</h3>
            <div class="output-area" id="proxy-output">结果将显示在这里</div>

            <h4>代理状态</h4>
            <div id="proxy-state">状态将显示在这里</div>
          </div>
        </div>
      </section>
    </div>

    <script>
      // 基本 Proxy 示例
      const basicProxyDemo = () => {
        const target = {
          message: "Hello, World!",
        };

        const handler = {
          get(target, prop, receiver) {
            if (prop === "message") {
              return target[prop].toUpperCase();
            }
            return Reflect.get(...arguments);
          },
        };

        const proxy = new Proxy(target, handler);
        return proxy.message;
      };

      document.getElementById("basic-proxy").textContent = basicProxyDemo();

      // Proxy 工作流程示例
      const workflowDemo = () => {
        const target = { name: "Alice", age: 30 };
        let output = "";

        const handler = {
          get(target, property) {
            output += `读取属性: ${property}<br>`;
            return target[property];
          },

          set(target, property, value) {
            output += `设置属性: ${property} = ${value}<br>`;
            target[property] = value;
            return true;
          },
        };

        const proxy = new Proxy(target, handler);

        // 通过代理访问属性
        output += `名称: ${proxy.name}<br>`;
        proxy.age = 31;
        output += `新年龄: ${proxy.age}`;

        return output;
      };

      document.getElementById("proxy-workflow").innerHTML = workflowDemo();

      // 数据验证示例
      const validationDemo = () => {
        function createValidatedObject() {
          const target = {};
          const handler = {
            set(target, prop, value) {
              if (prop === "age") {
                if (typeof value !== "number" || value < 0 || value > 150) {
                  throw new Error("年龄必须是0到150之间的数字");
                }
              }
              if (prop === "email") {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(value)) {
                  throw new Error("邮箱格式不正确");
                }
              }
              target[prop] = value;
              return true;
            },
          };
          return new Proxy(target, handler);
        }

        const user = createValidatedObject();
        let output = "";

        try {
          user.age = 25;
          output += `设置年龄: 25 (成功)<br>`;
        } catch (e) {
          output += `设置年龄: 25 (失败 - ${e.message})<br>`;
        }

        try {
          user.age = -5;
          output += `设置年龄: -5 (成功)<br>`;
        } catch (e) {
          output += `设置年龄: -5 (失败 - ${e.message})<br>`;
        }

        try {
          user.email = "test@example.com";
          output += `设置邮箱: test@example.com (成功)<br>`;
        } catch (e) {
          output += `设置邮箱: test@example.com (失败 - ${e.message})<br>`;
        }

        try {
          user.email = "invalid";
          output += `设置邮箱: invalid (成功)<br>`;
        } catch (e) {
          output += `设置邮箱: invalid (失败 - ${e.message})<br>`;
        }

        return output;
      };

      document.getElementById("validation-example").innerHTML = validationDemo();

      // 日志记录示例
      const loggingDemo = () => {
        function createLoggableObject() {
          const target = {};
          const handler = {
            get(target, prop) {
              return target[prop];
            },
            set(target, prop, value) {
              target[prop] = value;
              return true;
            },
          };
          return new Proxy(target, handler);
        }

        const obj = createLoggableObject();
        obj.name = "Alice";
        const name = obj.name;

        return `对象已创建，属性已设置和读取`;
      };

      document.getElementById("logging-example").textContent = loggingDemo();

      // 负索引数组示例
      const negativeIndexDemo = () => {
        function createNegativeIndexArray(...elements) {
          const array = [...elements];
          const handler = {
            get(target, prop) {
              let index = Number(prop);
              // 如果是负索引，从末尾开始计算
              if (index < 0) {
                index = target.length + index;
              }
              return target[index];
            },
          };
          return new Proxy(array, handler);
        }

        const arr = createNegativeIndexArray("a", "b", "c", "d");
        return `arr[-1] = ${arr[-1]}, arr[-2] = ${arr[-2]}`;
      };

      document.getElementById("negative-index-example").textContent = negativeIndexDemo();

      // 交互式演示
      let interactiveProxy = null;
      let interactiveTarget = {};

      document.getElementById("create-proxy").addEventListener("click", () => {
        const enableValidation = document.getElementById("enable-validation").checked;
        const enableLogging = document.getElementById("enable-logging").checked;

        const handler = {};

        if (enableValidation) {
          handler.set = function (target, prop, value) {
            if (prop === "age") {
              if (typeof value !== "number" || value < 0 || value > 150) {
                throw new Error("年龄必须是0到150之间的数字");
              }
            }
            if (prop === "email") {
              const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
              if (!emailRegex.test(value)) {
                throw new Error("邮箱格式不正确");
              }
            }
            target[prop] = value;
            return true;
          };
        }

        if (enableLogging) {
          const originalSet = handler.set;
          handler.set = function (target, prop, value) {
            document.getElementById("proxy-output").innerHTML += `设置属性: ${prop} = ${value}<br>`;
            if (originalSet) {
              return originalSet(target, prop, value);
            } else {
              target[prop] = value;
              return true;
            }
          };

          handler.get = function (target, prop) {
            document.getElementById("proxy-output").innerHTML += `读取属性: ${prop}<br>`;
            return target[prop];
          };
        }

        interactiveProxy = new Proxy(interactiveTarget, handler);
        document.getElementById("proxy-output").innerHTML = "代理已创建<br>";
        updateProxyState();
      });

      document.getElementById("get-property").addEventListener("click", () => {
        const propertyName = document.getElementById("property-name").value;
        if (interactiveProxy) {
          try {
            const value = interactiveProxy[propertyName];
            document.getElementById("proxy-output").innerHTML += `属性 "${propertyName}" 的值: ${value}<br>`;
          } catch (e) {
            document.getElementById("proxy-output").innerHTML += `错误: ${e.message}<br>`;
          }
          updateProxyState();
        } else {
          document.getElementById("proxy-output").innerHTML += "请先创建代理<br>";
        }
      });

      document.getElementById("set-property").addEventListener("click", () => {
        const propertyName = document.getElementById("property-name").value;
        const propertyValue = document.getElementById("property-value").value;
        if (interactiveProxy) {
          try {
            interactiveProxy[propertyName] = propertyValue;
            document.getElementById("proxy-output").innerHTML += `成功设置属性 "${propertyName}" = "${propertyValue}"<br>`;
          } catch (e) {
            document.getElementById("proxy-output").innerHTML += `错误: ${e.message}<br>`;
          }
          updateProxyState();
        } else {
          document.getElementById("proxy-output").innerHTML += "请先创建代理<br>";
        }
      });

      function updateProxyState() {
        const stateElement = document.getElementById("proxy-state");
        stateElement.innerHTML = "";

        for (const key in interactiveTarget) {
          stateElement.innerHTML += `${key}: ${interactiveTarget[key]}<br>`;
        }

        if (stateElement.innerHTML === "") {
          stateElement.innerHTML = "没有属性";
        }
      }
    </script>
  </body>
</html>
