<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JavaScript Proxy æ„é€ å‡½æ•°è¯¦è§£</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        color: #333;
        background: linear-gradient(135deg, #f5f7fa 0%, #e4efe9 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      header {
        text-align: center;
        margin-bottom: 40px;
      }

      h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
        color: #2c3e50;
      }

      .description {
        font-size: 1.2rem;
        color: #7f8c8d;
        max-width: 800px;
        margin: 0 auto;
      }

      section {
        background-color: white;
        padding: 25px;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
      }

      h2 {
        color: #2c3e50;
        margin-bottom: 20px;
        border-bottom: 2px solid #eee;
        padding-bottom: 10px;
      }

      h3 {
        color: #3498db;
        margin: 20px 0 15px;
      }

      p {
        margin-bottom: 15px;
      }

      .code-example {
        background-color: #2d3436;
        color: #f5f7fa;
        padding: 15px;
        border-radius: 5px;
        font-family: "Fira Code", monospace;
        margin: 15px 0;
        overflow-x: auto;
      }

      .js-keyword {
        color: #74b9ff;
      }

      .js-function {
        color: #55efc4;
      }

      .js-number {
        color: #ffeaa7;
      }

      .js-string {
        color: #fd79a8;
      }

      .js-comment {
        color: #a29bfe;
      }

      .note {
        background-color: #e3f2fd;
        border-left: 4px solid #2196f3;
        padding: 15px;
        margin: 15px 0;
        border-radius: 0 5px 5px 0;
      }

      .demo-area {
        background-color: #f8f9fa;
        padding: 20px;
        border-radius: 5px;
        margin: 20px 0;
        border: 1px solid #e9ecef;
      }

      .demo-result {
        background-color: #2d3436;
        color: #f5f7fa;
        padding: 15px;
        border-radius: 5px;
        margin: 15px 0;
        font-family: "Fira Code", monospace;
      }

      .handler-methods {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
        margin: 20px 0;
      }

      .handler-item {
        background-color: #f8f9fa;
        padding: 15px;
        border-radius: 5px;
        border: 1px solid #e9ecef;
      }

      .handler-title {
        font-weight: bold;
        color: #2c3e50;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
      }

      .handler-icon {
        margin-right: 10px;
        color: #3498db;
      }

      .interactive-demo {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin: 20px 0;
      }

      .input-group {
        margin-bottom: 15px;
      }

      .input-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
      }

      .input-group input,
      .input-group select {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-family: "Fira Code", monospace;
      }

      .btn {
        padding: 10px 20px;
        background-color: #3498db;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 1rem;
        transition: background-color 0.3s ease;
      }

      .btn:hover {
        background-color: #2980b9;
      }

      .output-area {
        background-color: #2d3436;
        color: #f5f7fa;
        padding: 15px;
        border-radius: 5px;
        font-family: "Fira Code", monospace;
        min-height: 200px;
        overflow-y: auto;
      }

      .proxy-visualization {
        display: flex;
        flex-direction: column;
        gap: 15px;
        margin: 20px 0;
      }

      .proxy-step {
        display: flex;
        align-items: center;
        padding: 15px;
        background-color: #f8f9fa;
        border-radius: 5px;
        border: 1px solid #e9ecef;
      }

      .step-number {
        background-color: #3498db;
        color: white;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 15px;
        font-weight: bold;
      }

      .step-description {
        flex: 1;
      }

      @media (max-width: 768px) {
        .handler-methods,
        .interactive-demo {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>JavaScript Proxy æ„é€ å‡½æ•°è¯¦è§£</h1>
        <p class="description">æ¢ç´¢JavaScriptä¸­Proxyæ„é€ å‡½æ•°çš„æ¦‚å¿µã€ç”¨æ³•å’Œå®é™…åº”ç”¨</p>
      </header>

      <section>
        <h2>Proxy æ¦‚è¿°</h2>
        <p>Proxy å¯¹è±¡ç”¨äºåˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„ä»£ç†ï¼Œä»è€Œå¯ä»¥æ‹¦æˆªå’Œè‡ªå®šä¹‰å¯¹è±¡çš„åº•å±‚æ“ä½œã€‚</p>

        <div class="note">
          <p><strong>Proxy è¯­æ³•ï¼š</strong>new Proxy(target, handler)</p>
          <ul style="margin-left: 20px;">
            <li><code>target</code>ï¼šè¦ä»£ç†çš„ç›®æ ‡å¯¹è±¡</li>
            <li><code>handler</code>ï¼šä¸€ä¸ªå¯¹è±¡ï¼Œå…¶å±æ€§æ˜¯å®šä¹‰ä»£ç†è¡Œä¸ºçš„å‡½æ•°</li>
          </ul>
        </div>

        <div class="code-example">
          <span class="js-comment">// åŸºæœ¬ Proxy ç¤ºä¾‹</span><br />
          <span class="js-keyword">const</span> target = {<br />
          &nbsp;&nbsp;<span class="js-keyword">message</span>: <span class="js-string">"Hello, World!"</span><br />
          };<br />
          <br />
          <span class="js-keyword">const</span> handler = {<br />
          &nbsp;&nbsp;<span class="js-function">get</span>(target, prop, receiver) {<br />
          &nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">if</span> (prop === <span class="js-string">'message'</span>) {<br />
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">return</span> target[prop].<span class="js-function">toUpperCase</span>();<br />
          &nbsp;&nbsp;&nbsp;&nbsp;}<br />
          &nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">return</span> <span class="js-function">Reflect</span>.<span class="js-function">get</span>(...arguments);<br />
          &nbsp;&nbsp;}<br />
          };<br />
          <br />
          <span class="js-keyword">const</span> proxy = <span class="js-keyword">new</span> <span class="js-function">Proxy</span>(target, handler);<br />
          <span class="js-function">console.log</span>(proxy.message); <span class="js-comment">// "HELLO, WORLD!"</span>
        </div>

        <div class="demo-result" id="basic-proxy">
          <!-- å°†ç”±JavaScriptå¡«å…… -->
        </div>
      </section>

      <section>
        <h2>Proxy å·¥ä½œåŸç†</h2>

        <div class="proxy-visualization">
          <div class="proxy-step">
            <div class="step-number">1</div>
            <div class="step-description">åˆ›å»ºç›®æ ‡å¯¹è±¡å’Œå¤„ç†å™¨å¯¹è±¡</div>
          </div>

          <div class="proxy-step">
            <div class="step-number">2</div>
            <div class="step-description">ä½¿ç”¨ <code>new Proxy(target, handler)</code> åˆ›å»ºä»£ç†</div>
          </div>

          <div class="proxy-step">
            <div class="step-number">3</div>
            <div class="step-description">é€šè¿‡ä»£ç†å¯¹è±¡è®¿é—®ç›®æ ‡å¯¹è±¡çš„å±æ€§æˆ–æ–¹æ³•</div>
          </div>

          <div class="proxy-step">
            <div class="step-number">4</div>
            <div class="step-description">ä»£ç†æ‹¦æˆªæ“ä½œå¹¶è°ƒç”¨å¤„ç†å™¨ä¸­å¯¹åº”çš„é™·é˜±å‡½æ•°</div>
          </div>

          <div class="proxy-step">
            <div class="step-number">5</div>
            <div class="step-description">é™·é˜±å‡½æ•°å¯ä»¥è‡ªå®šä¹‰è¡Œä¸ºï¼Œä¹Ÿå¯ä»¥å°†æ“ä½œè½¬å‘ç»™ç›®æ ‡å¯¹è±¡</div>
          </div>
        </div>

        <div class="demo-area">
          <h3>Proxy å·¥ä½œæµç¨‹ç¤ºä¾‹</h3>
          <div class="code-example">
            <span class="js-keyword">const</span> target = { <span class="js-keyword">name</span>: <span class="js-string">"Alice"</span>, <span class="js-keyword">age</span>: <span class="js-number">30</span> };<br />
            <br />
            <span class="js-keyword">const</span> handler = {<br />
            &nbsp;&nbsp;<span class="js-comment">// æ‹¦æˆªå±æ€§è¯»å–æ“ä½œ</span><br />
            &nbsp;&nbsp;<span class="js-function">get</span>(target, property) {<br />
            &nbsp;&nbsp;&nbsp;&nbsp;<span class="js-function">console.log</span>(<span class="js-string">`è¯»å–å±æ€§: <span class="js-keyword">${</span>property<span class="js-keyword">}</span>`</span>);<br />
            &nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">return</span> target[property];<br />
            &nbsp;&nbsp;},<br />
            <br />
            &nbsp;&nbsp;<span class="js-comment">// æ‹¦æˆªå±æ€§è®¾ç½®æ“ä½œ</span><br />
            &nbsp;&nbsp;<span class="js-function">set</span>(target, property, value) {<br />
            &nbsp;&nbsp;&nbsp;&nbsp;<span class="js-function">console.log</span>(<span class="js-string">`è®¾ç½®å±æ€§: <span class="js-keyword">${</span>property<span class="js-keyword">}</span> = <span class="js-keyword">${</span>value<span class="js-keyword">}</span>`</span>);<br />
            &nbsp;&nbsp;&nbsp;&nbsp;target[property] = value;<br />
            &nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">return</span> <span class="js-keyword">true</span>; <span class="js-comment">// è¡¨ç¤ºè®¾ç½®æˆåŠŸ</span><br />
            &nbsp;&nbsp;}<br />
            };<br />
            <br />
            <span class="js-keyword">const</span> proxy = <span class="js-keyword">new</span> <span class="js-function">Proxy</span>(target, handler);<br />
            <br />
            <span class="js-comment">// é€šè¿‡ä»£ç†è®¿é—®å±æ€§</span><br />
            <span class="js-function">console.log</span>(proxy.name); <span class="js-comment">// è§¦å‘geté™·é˜±</span><br />
            proxy.age = <span class="js-number">31</span>; <span class="js-comment">// è§¦å‘seté™·é˜±</span>
          </div>

          <div class="demo-result" id="proxy-workflow">
            <!-- å°†ç”±JavaScriptå¡«å…… -->
          </div>
        </div>
      </section>

      <section>
        <h2>å¸¸ç”¨çš„å¤„ç†å™¨æ–¹æ³•</h2>

        <div class="handler-methods">
          <div class="handler-item">
            <div class="handler-title">
              <span class="handler-icon">ğŸ“</span>
              <span>get(target, prop, receiver)</span>
            </div>
            <p>æ‹¦æˆªå¯¹è±¡å±æ€§çš„è¯»å–æ“ä½œã€‚</p>
            <div class="code-example">
              <span class="js-function">get</span>(target, prop) {<br />
              &nbsp;&nbsp;<span class="js-keyword">return</span> target[prop] || <span class="js-string">'é»˜è®¤å€¼'</span>;<br />
              }
            </div>
          </div>

          <div class="handler-item">
            <div class="handler-title">
              <span class="handler-icon">âœï¸</span>
              <span>set(target, prop, value, receiver)</span>
            </div>
            <p>æ‹¦æˆªå¯¹è±¡å±æ€§çš„è®¾ç½®æ“ä½œã€‚</p>
            <div class="code-example">
              <span class="js-function">set</span>(target, prop, value) {<br />
              &nbsp;&nbsp;<span class="js-keyword">if</span> (prop === <span class="js-string">'age'</span> && value < <span class="js-number">0</span>) {<br />
              &nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">throw</span> <span class="js-keyword">new</span> <span class="js-function">Error</span>(<span class="js-string">'å¹´é¾„ä¸èƒ½ä¸ºè´Ÿæ•°'</span>);<br />
              &nbsp;&nbsp;}<br />
              &nbsp;&nbsp;target[prop] = value;<br />
              &nbsp;&nbsp;<span class="js-keyword">return</span> <span class="js-keyword">true</span>;<br />
              }
            </div>
          </div>

          <div class="handler-item">
            <div class="handler-title">
              <span class="handler-icon">ğŸ”</span>
              <span>has(target, prop)</span>
            </div>
            <p>æ‹¦æˆª <code>in</code> æ“ä½œç¬¦çš„è¡Œä¸ºã€‚</p>
            <div class="code-example">
              <span class="js-function">has</span>(target, prop) {<br />
              &nbsp;&nbsp;<span class="js-keyword">if</span> (prop.<span class="js-function">startsWith</span>(<span class="js-string">'_'</span>)) {<br />
              &nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">return</span> <span class="js-keyword">false</span>; <span class="js-comment">// éšè—ç§æœ‰å±æ€§</span><br />
              &nbsp;&nbsp;}<br />
              &nbsp;&nbsp;<span class="js-keyword">return</span> prop <span class="js-keyword">in</span> target;<br />
              }
            </div>
          </div>

          <div class="handler-item">
            <div class="handler-title">
              <span class="handler-icon">ğŸ—‘ï¸</span>
              <span>deleteProperty(target, prop)</span>
            </div>
            <p>æ‹¦æˆª <code>delete</code> æ“ä½œç¬¦çš„è¡Œä¸ºã€‚</p>
            <div class="code-example">
              <span class="js-function">deleteProperty</span>(target, prop) {<br />
              &nbsp;&nbsp;<span class="js-keyword">if</span> (prop === <span class="js-string">'id'</span>) {<br />
              &nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">throw</span> <span class="js-keyword">new</span> <span class="js-function">Error</span>(<span class="js-string">'ä¸èƒ½åˆ é™¤idå±æ€§'</span>);<br />
              &nbsp;&nbsp;}<br />
              &nbsp;&nbsp;<span class="js-keyword">return</span> <span class="js-keyword">true</span>;<br />
              }
            </div>
          </div>

          <div class="handler-item">
            <div class="handler-title">
              <span class="handler-icon">ğŸ“‹</span>
              <span>ownKeys(target)</span>
            </div>
            <p>æ‹¦æˆª <code>Object.getOwnPropertyNames()</code> å’Œç±»ä¼¼æ“ä½œã€‚</p>
            <div class="code-example">
              <span class="js-function">ownKeys</span>(target) {<br />
              &nbsp;&nbsp;<span class="js-keyword">return</span> <span class="js-function">Object</span>.<span class="js-function">getOwnPropertyNames</span>(target)<br />
              &nbsp;&nbsp;&nbsp;&nbsp;.<span class="js-function">filter</span>(key => !key.<span class="js-function">startsWith</span>(<span class="js-string">'_'</span>));<br />
              }
            </div>
          </div>

          <div class="handler-item">
            <div class="handler-title">
              <span class="handler-icon">ğŸ”„</span>
              <span>apply(target, thisArg, argumentsList)</span>
            </div>
            <p>æ‹¦æˆªå‡½æ•°çš„è°ƒç”¨æ“ä½œã€‚</p>
            <div class="code-example">
              <span class="js-function">apply</span>(target, thisArg, argumentsList) {<br />
              &nbsp;&nbsp;<span class="js-function">console.log</span>(<span class="js-string">`å‡½æ•°è¢«è°ƒç”¨ï¼Œå‚æ•°: <span class="js-keyword">${</span>argumentsList<span class="js-keyword">}</span>`</span>);<br />
              &nbsp;&nbsp;<span class="js-keyword">return</span> target.<span class="js-function">apply</span>(thisArg, argumentsList);<br />
              }
            </div>
          </div>
        </div>
      </section>

      <section>
        <h2>Proxy å®é™…åº”ç”¨ç¤ºä¾‹</h2>

        <div class="demo-area">
          <h3>1. æ•°æ®éªŒè¯</h3>
          <div class="code-example">
            <span class="js-keyword">function</span> <span class="js-function">createValidatedObject</span>() {<br />
            &nbsp;&nbsp;<span class="js-keyword">const</span> target = {};<br />
            &nbsp;&nbsp;<span class="js-keyword">const</span> handler = {<br />
            &nbsp;&nbsp;&nbsp;&nbsp;<span class="js-function">set</span>(target, prop, value) {<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">if</span> (prop === <span class="js-string">'age'</span>) {<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">if</span> (<span class="js-keyword">typeof</span> value !== <span class="js-string">'number'</span> || value < <span class="js-number">0</span> || value > <span class="js-number">150</span>) {<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">throw</span> <span class="js-keyword">new</span> <span class="js-function">Error</span>(<span class="js-string">'å¹´é¾„å¿…é¡»æ˜¯0åˆ°150ä¹‹é—´çš„æ•°å­—'</span>);<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">if</span> (prop === <span class="js-string">'email'</span>) {<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">const</span> emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">if</span> (!emailRegex.<span class="js-function">test</span>(value)) {<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">throw</span> <span class="js-keyword">new</span> <span class="js-function">Error</span>(<span class="js-string">'é‚®ç®±æ ¼å¼ä¸æ­£ç¡®'</span>);<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;target[prop] = value;<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">return</span> <span class="js-keyword">true</span>;<br />
            &nbsp;&nbsp;&nbsp;&nbsp;}<br />
            &nbsp;&nbsp;};<br />
            &nbsp;&nbsp;<span class="js-keyword">return</span> <span class="js-keyword">new</span> <span class="js-function">Proxy</span>(target, handler);<br />
            }<br />
            <br />
            <span class="js-keyword">const</span> user = <span class="js-function">createValidatedObject</span>();<br />
            user.age = <span class="js-number">25</span>; <span class="js-comment">// æˆåŠŸ</span><br />
            <span class="js-comment">// user.age = -5; // æŠ›å‡ºé”™è¯¯</span><br />
            user.email = <span class="js-string">"test@example.com"</span>; <span class="js-comment">// æˆåŠŸ</span><br />
            <span class="js-comment">// user.email = "invalid" // æŠ›å‡ºé”™è¯¯</span>
          </div>

          <div class="demo-result" id="validation-example">
            <!-- å°†ç”±JavaScriptå¡«å…… -->
          </div>
        </div>

        <div class="demo-area">
          <h3>2. æ—¥å¿—è®°å½•</h3>
          <div class="code-example">
            <span class="js-keyword">function</span> <span class="js-function">createLoggableObject</span>() {<br />
            &nbsp;&nbsp;<span class="js-keyword">const</span> target = {};<br />
            &nbsp;&nbsp;<span class="js-keyword">const</span> handler = {<br />
            &nbsp;&nbsp;&nbsp;&nbsp;<span class="js-function">get</span>(target, prop) {<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js-function">console.log</span>(<span class="js-string">`è¯»å–å±æ€§ '<span class="js-keyword">${</span>prop<span class="js-keyword">}</span>'`</span>);<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">return</span> target[prop];<br />
            &nbsp;&nbsp;&nbsp;&nbsp;},<br />
            &nbsp;&nbsp;&nbsp;&nbsp;<span class="js-function">set</span>(target, prop, value) {<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js-function">console.log</span>(<span class="js-string">`è®¾ç½®å±æ€§ '<span class="js-keyword">${</span>prop<span class="js-keyword">}</span>' = '<span class="js-keyword">${</span>value<span class="js-keyword">}</span>'`</span>);<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;target[prop] = value;<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">return</span> <span class="js-keyword">true</span>;<br />
            &nbsp;&nbsp;&nbsp;&nbsp;}<br />
            &nbsp;&nbsp;};<br />
            &nbsp;&nbsp;<span class="js-keyword">return</span> <span class="js-keyword">new</span> <span class="js-function">Proxy</span>(target, handler);<br />
            }<br />
            <br />
            <span class="js-keyword">const</span> obj = <span class="js-function">createLoggableObject</span>();<br />
            obj.name = <span class="js-string">"Alice"</span>; <span class="js-comment">// æ—¥å¿—: è®¾ç½®å±æ€§ 'name' = 'Alice'</span><br />
            <span class="js-keyword">const</span> name = obj.name; <span class="js-comment">// æ—¥å¿—: è¯»å–å±æ€§ 'name'</span>
          </div>

          <div class="demo-result" id="logging-example">
            <!-- å°†ç”±JavaScriptå¡«å…… -->
          </div>
        </div>

        <div class="demo-area">
          <h3>3. æ•°ç»„è´Ÿç´¢å¼•æ”¯æŒ</h3>
          <div class="code-example">
            <span class="js-keyword">function</span> <span class="js-function">createNegativeIndexArray</span>(...elements) {<br />
            &nbsp;&nbsp;<span class="js-keyword">const</span> array = [...elements];<br />
            &nbsp;&nbsp;<span class="js-keyword">const</span> handler = {<br />
            &nbsp;&nbsp;&nbsp;&nbsp;<span class="js-function">get</span>(target, prop) {<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">let</span> index = <span class="js-function">Number</span>(prop);<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js-comment">// å¦‚æœæ˜¯è´Ÿç´¢å¼•ï¼Œä»æœ«å°¾å¼€å§‹è®¡ç®—</span><br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">if</span> (index < <span class="js-number">0</span>) {<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index = target.length + index;<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">return</span> target[index];<br />
            &nbsp;&nbsp;&nbsp;&nbsp;}<br />
            &nbsp;&nbsp;};<br />
            &nbsp;&nbsp;<span class="js-keyword">return</span> <span class="js-keyword">new</span> <span class="js-function">Proxy</span>(array, handler);<br />
            }<br />
            <br />
            <span class="js-keyword">const</span> arr = <span class="js-function">createNegativeIndexArray</span>(<span class="js-string">'a'</span>, <span class="js-string">'b'</span>, <span class="js-string">'c'</span>, <span class="js-string">'d'</span>);<br />
            <span class="js-function">console.log</span>(arr[-<span class="js-number">1</span>]); <span class="js-comment">// 'd'ï¼ˆæœ€åä¸€ä¸ªå…ƒç´ ï¼‰</span><br />
            <span class="js-function">console.log</span>(arr[-<span class="js-number">2</span>]); <span class="js-comment">// 'c'ï¼ˆå€’æ•°ç¬¬äºŒä¸ªå…ƒç´ ï¼‰</span>
          </div>

          <div class="demo-result" id="negative-index-example">
            <!-- å°†ç”±JavaScriptå¡«å…… -->
          </div>
        </div>
      </section>

      <section>
        <h2>äº¤äº’å¼ Proxy æ¼”ç¤º</h2>

        <div class="interactive-demo">
          <div>
            <h3>åˆ›å»ºä»£ç†å¯¹è±¡</h3>
            <div class="input-group">
              <label for="property-name">å±æ€§å:</label>
              <input type="text" id="property-name" value="message" />
            </div>

            <div class="input-group">
              <label for="property-value">å±æ€§å€¼:</label>
              <input type="text" id="property-value" value="Hello, Proxy!" />
            </div>

            <div class="input-group" style="display: flex; justify-content: start; align-items: center;">
              <label for="enable-validation" style="margin-bottom: 0; margin-right: 8px;">å¯ç”¨éªŒè¯</label>
              <input type="checkbox" id="enable-validation" style="width: 16px; height: 16px;" />
            </div>

            <div class="input-group" style="display: flex; justify-content: start; align-items: center;">
              <label for="enable-logging" style="margin-bottom: 0; margin-right: 8px;">å¯ç”¨æ—¥å¿—</label>
              <input type="checkbox" id="enable-logging" style="width: 16px; height: 16px;" />
            </div>

            <button class="btn" id="create-proxy">åˆ›å»ºä»£ç†</button>
            <button class="btn" id="get-property">è¯»å–å±æ€§</button>
            <button class="btn" id="set-property">è®¾ç½®å±æ€§</button>
          </div>

          <div>
            <h3>æ“ä½œç»“æœ</h3>
            <div class="output-area" id="proxy-output">ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</div>

            <h4>ä»£ç†çŠ¶æ€</h4>
            <div id="proxy-state">çŠ¶æ€å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</div>
          </div>
        </div>
      </section>
    </div>

    <script>
      // åŸºæœ¬ Proxy ç¤ºä¾‹
      const basicProxyDemo = () => {
        const target = {
          message: "Hello, World!",
        };

        const handler = {
          get(target, prop, receiver) {
            if (prop === "message") {
              return target[prop].toUpperCase();
            }
            return Reflect.get(...arguments);
          },
        };

        const proxy = new Proxy(target, handler);
        return proxy.message;
      };

      document.getElementById("basic-proxy").textContent = basicProxyDemo();

      // Proxy å·¥ä½œæµç¨‹ç¤ºä¾‹
      const workflowDemo = () => {
        const target = { name: "Alice", age: 30 };
        let output = "";

        const handler = {
          get(target, property) {
            output += `è¯»å–å±æ€§: ${property}<br>`;
            return target[property];
          },

          set(target, property, value) {
            output += `è®¾ç½®å±æ€§: ${property} = ${value}<br>`;
            target[property] = value;
            return true;
          },
        };

        const proxy = new Proxy(target, handler);

        // é€šè¿‡ä»£ç†è®¿é—®å±æ€§
        output += `åç§°: ${proxy.name}<br>`;
        proxy.age = 31;
        output += `æ–°å¹´é¾„: ${proxy.age}`;

        return output;
      };

      document.getElementById("proxy-workflow").innerHTML = workflowDemo();

      // æ•°æ®éªŒè¯ç¤ºä¾‹
      const validationDemo = () => {
        function createValidatedObject() {
          const target = {};
          const handler = {
            set(target, prop, value) {
              if (prop === "age") {
                if (typeof value !== "number" || value < 0 || value > 150) {
                  throw new Error("å¹´é¾„å¿…é¡»æ˜¯0åˆ°150ä¹‹é—´çš„æ•°å­—");
                }
              }
              if (prop === "email") {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(value)) {
                  throw new Error("é‚®ç®±æ ¼å¼ä¸æ­£ç¡®");
                }
              }
              target[prop] = value;
              return true;
            },
          };
          return new Proxy(target, handler);
        }

        const user = createValidatedObject();
        let output = "";

        try {
          user.age = 25;
          output += `è®¾ç½®å¹´é¾„: 25 (æˆåŠŸ)<br>`;
        } catch (e) {
          output += `è®¾ç½®å¹´é¾„: 25 (å¤±è´¥ - ${e.message})<br>`;
        }

        try {
          user.age = -5;
          output += `è®¾ç½®å¹´é¾„: -5 (æˆåŠŸ)<br>`;
        } catch (e) {
          output += `è®¾ç½®å¹´é¾„: -5 (å¤±è´¥ - ${e.message})<br>`;
        }

        try {
          user.email = "test@example.com";
          output += `è®¾ç½®é‚®ç®±: test@example.com (æˆåŠŸ)<br>`;
        } catch (e) {
          output += `è®¾ç½®é‚®ç®±: test@example.com (å¤±è´¥ - ${e.message})<br>`;
        }

        try {
          user.email = "invalid";
          output += `è®¾ç½®é‚®ç®±: invalid (æˆåŠŸ)<br>`;
        } catch (e) {
          output += `è®¾ç½®é‚®ç®±: invalid (å¤±è´¥ - ${e.message})<br>`;
        }

        return output;
      };

      document.getElementById("validation-example").innerHTML = validationDemo();

      // æ—¥å¿—è®°å½•ç¤ºä¾‹
      const loggingDemo = () => {
        function createLoggableObject() {
          const target = {};
          const handler = {
            get(target, prop) {
              return target[prop];
            },
            set(target, prop, value) {
              target[prop] = value;
              return true;
            },
          };
          return new Proxy(target, handler);
        }

        const obj = createLoggableObject();
        obj.name = "Alice";
        const name = obj.name;

        return `å¯¹è±¡å·²åˆ›å»ºï¼Œå±æ€§å·²è®¾ç½®å’Œè¯»å–`;
      };

      document.getElementById("logging-example").textContent = loggingDemo();

      // è´Ÿç´¢å¼•æ•°ç»„ç¤ºä¾‹
      const negativeIndexDemo = () => {
        function createNegativeIndexArray(...elements) {
          const array = [...elements];
          const handler = {
            get(target, prop) {
              let index = Number(prop);
              // å¦‚æœæ˜¯è´Ÿç´¢å¼•ï¼Œä»æœ«å°¾å¼€å§‹è®¡ç®—
              if (index < 0) {
                index = target.length + index;
              }
              return target[index];
            },
          };
          return new Proxy(array, handler);
        }

        const arr = createNegativeIndexArray("a", "b", "c", "d");
        return `arr[-1] = ${arr[-1]}, arr[-2] = ${arr[-2]}`;
      };

      document.getElementById("negative-index-example").textContent = negativeIndexDemo();

      // äº¤äº’å¼æ¼”ç¤º
      let interactiveProxy = null;
      let interactiveTarget = {};

      document.getElementById("create-proxy").addEventListener("click", () => {
        const enableValidation = document.getElementById("enable-validation").checked;
        const enableLogging = document.getElementById("enable-logging").checked;

        const handler = {};

        if (enableValidation) {
          handler.set = function (target, prop, value) {
            if (prop === "age") {
              if (typeof value !== "number" || value < 0 || value > 150) {
                throw new Error("å¹´é¾„å¿…é¡»æ˜¯0åˆ°150ä¹‹é—´çš„æ•°å­—");
              }
            }
            if (prop === "email") {
              const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
              if (!emailRegex.test(value)) {
                throw new Error("é‚®ç®±æ ¼å¼ä¸æ­£ç¡®");
              }
            }
            target[prop] = value;
            return true;
          };
        }

        if (enableLogging) {
          const originalSet = handler.set;
          handler.set = function (target, prop, value) {
            document.getElementById("proxy-output").innerHTML += `è®¾ç½®å±æ€§: ${prop} = ${value}<br>`;
            if (originalSet) {
              return originalSet(target, prop, value);
            } else {
              target[prop] = value;
              return true;
            }
          };

          handler.get = function (target, prop) {
            document.getElementById("proxy-output").innerHTML += `è¯»å–å±æ€§: ${prop}<br>`;
            return target[prop];
          };
        }

        interactiveProxy = new Proxy(interactiveTarget, handler);
        document.getElementById("proxy-output").innerHTML = "ä»£ç†å·²åˆ›å»º<br>";
        updateProxyState();
      });

      document.getElementById("get-property").addEventListener("click", () => {
        const propertyName = document.getElementById("property-name").value;
        if (interactiveProxy) {
          try {
            const value = interactiveProxy[propertyName];
            document.getElementById("proxy-output").innerHTML += `å±æ€§ "${propertyName}" çš„å€¼: ${value}<br>`;
          } catch (e) {
            document.getElementById("proxy-output").innerHTML += `é”™è¯¯: ${e.message}<br>`;
          }
          updateProxyState();
        } else {
          document.getElementById("proxy-output").innerHTML += "è¯·å…ˆåˆ›å»ºä»£ç†<br>";
        }
      });

      document.getElementById("set-property").addEventListener("click", () => {
        const propertyName = document.getElementById("property-name").value;
        const propertyValue = document.getElementById("property-value").value;
        if (interactiveProxy) {
          try {
            interactiveProxy[propertyName] = propertyValue;
            document.getElementById("proxy-output").innerHTML += `æˆåŠŸè®¾ç½®å±æ€§ "${propertyName}" = "${propertyValue}"<br>`;
          } catch (e) {
            document.getElementById("proxy-output").innerHTML += `é”™è¯¯: ${e.message}<br>`;
          }
          updateProxyState();
        } else {
          document.getElementById("proxy-output").innerHTML += "è¯·å…ˆåˆ›å»ºä»£ç†<br>";
        }
      });

      function updateProxyState() {
        const stateElement = document.getElementById("proxy-state");
        stateElement.innerHTML = "";

        for (const key in interactiveTarget) {
          stateElement.innerHTML += `${key}: ${interactiveTarget[key]}<br>`;
        }

        if (stateElement.innerHTML === "") {
          stateElement.innerHTML = "æ²¡æœ‰å±æ€§";
        }
      }
    </script>
  </body>
</html>
